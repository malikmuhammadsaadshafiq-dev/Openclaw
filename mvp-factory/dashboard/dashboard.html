<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MVP Factory | Command Center</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#x1f9de;</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* ========== RESET & BASE ========== */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

:root{
  /* Easing - from UX Mastery Phase 4 */
  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-in: cubic-bezier(0.55, 0, 1, 0.45);
  --ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-smooth: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
  --ease-snap: cubic-bezier(0.5, 0, 0, 1);
  /* 12-token color system - Phase 1 */
  --bg-deep: #060610;
  --bg-surface: #0d0d1a;
  --bg-elevated: #131320;
  --bg-overlay: rgba(6,6,16,0.85);
  --glass: rgba(255,255,255,0.035);
  --glass-border: rgba(255,255,255,0.06);
  --glass-hover: rgba(255,255,255,0.08);
  --glass-active: rgba(255,255,255,0.14);
  --bg-sidebar: #0a0a18;
  --text-primary: #eef0f4;
  --text-secondary: #8892a4;
  --text-tertiary: #4a5568;
  --accent-purple: #8b5cf6;
  --accent-blue: #3b82f6;
  --accent-cyan: #06b6d4;
  --accent-green: #10b981;
  --accent-amber: #f59e0b;
  --accent-rose: #f43f5e;
  --accent-pink: #ec4899;
  --accent-orange: #ff6200;
  /* Radii - tightened per Phase 3 */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 20px;
  /* Layout */
  --sidebar-w: 260px;
  --sidebar-collapsed: 68px;
  --header-h: 64px;
  /* Glow token */
  --glow-accent: rgba(139,92,246,0.15);
}

body{
  background: var(--bg-deep);
  min-height:100vh;
  font-family:'Inter',system-ui,-apple-system,sans-serif;
  color: var(--text-primary);
  overflow-x:hidden;
  position:relative;
  font-feature-settings:'cv02','cv03','cv04','cv11';
  -webkit-font-smoothing:antialiased;
}
/* Global scrollbar - Phase 6 */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.08);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.14)}
*{scrollbar-width:thin;scrollbar-color:rgba(255,255,255,0.08) transparent}

/* ========== AURORA BACKGROUND ========== */
.bg-layer{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.aurora-orb{position:absolute;border-radius:50%;filter:blur(140px);opacity:0.18;will-change:transform}
.aurora-orb:nth-child(1){width:65vw;height:65vw;background:radial-gradient(circle,rgba(139,92,246,0.6),transparent 70%);top:-35%;left:-15%;animation:aurora-1 30s ease-in-out infinite alternate}
.aurora-orb:nth-child(2){width:50vw;height:50vw;background:radial-gradient(circle,rgba(6,182,212,0.5),transparent 70%);bottom:-30%;right:-10%;animation:aurora-2 25s ease-in-out infinite alternate}
.aurora-orb:nth-child(3){width:35vw;height:35vw;background:radial-gradient(circle,rgba(16,185,129,0.4),transparent 70%);top:40%;left:55%;opacity:0.08;animation:aurora-3 35s ease-in-out infinite alternate}
.aurora-orb:nth-child(4){width:30vw;height:30vw;background:radial-gradient(circle,rgba(245,158,11,0.3),transparent 70%);bottom:15%;left:15%;opacity:0.06;animation:aurora-2 40s ease-in-out infinite alternate-reverse}
@keyframes aurora-1{0%{transform:translate(0,0) scale(1) rotate(0)}33%{transform:translate(3%,5%) scale(1.05) rotate(2deg)}66%{transform:translate(-2%,3%) scale(0.97) rotate(-1deg)}100%{transform:translate(1%,-2%) scale(1.03) rotate(1deg)}}
@keyframes aurora-2{0%{transform:translate(0,0) scale(1)}50%{transform:translate(-5%,-3%) scale(1.1)}100%{transform:translate(3%,5%) scale(0.93)}}
@keyframes aurora-3{0%{transform:translate(0,0) scale(1) rotate(0)}100%{transform:translate(-10%,8%) scale(1.15) rotate(8deg)}}

.dot-grid{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:radial-gradient(circle,rgba(255,255,255,0.018) 1px,transparent 1px);background-size:28px 28px}
.noise-overlay{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:0.015;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");mix-blend-mode:overlay}

/* ========== LAYOUT: SIDEBAR + MAIN ========== */
.app-layout{display:flex;min-height:100vh;position:relative;z-index:1}

/* ========== SIDEBAR ========== */
.sidebar{
  width:var(--sidebar-w);height:100vh;position:fixed;left:0;top:0;z-index:100;
  background:rgba(10,10,24,0.92);backdrop-filter:blur(32px) saturate(140%);
  border-right:1px solid rgba(255,255,255,0.05);
  display:flex;flex-direction:column;
  transition:width 0.35s var(--ease-out),transform 0.35s var(--ease-out);
  overflow:hidden;
}
.sidebar.collapsed{width:var(--sidebar-collapsed)}
.sidebar-header{
  height:var(--header-h);display:flex;align-items:center;gap:0.75rem;
  padding:0 1rem;border-bottom:1px solid rgba(255,255,255,0.05);flex-shrink:0;
}
.sidebar-logo{
  width:38px;height:38px;border-radius:12px;flex-shrink:0;
  background:linear-gradient(135deg,var(--accent-purple),var(--accent-cyan));
  display:flex;align-items:center;justify-content:center;font-size:1.1rem;
  box-shadow:0 4px 20px rgba(139,92,246,0.25);
  animation:logo-breathe 4s var(--ease-in-out) infinite;
  position:relative;
}
@keyframes logo-breathe{0%,100%{box-shadow:0 4px 20px rgba(139,92,246,0.2)}50%{box-shadow:0 4px 28px rgba(139,92,246,0.4),0 0 0 4px rgba(139,92,246,0.08)}}
.sidebar-brand{overflow:hidden;white-space:nowrap;transition:opacity 0.2s}
.sidebar.collapsed .sidebar-brand{opacity:0;width:0}
.sidebar-brand h2{font-size:1.1rem;font-weight:800;letter-spacing:-0.03em;background:linear-gradient(135deg,#c4b5fd,#a5f3fc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.sidebar-brand span{font-size:0.6rem;color:var(--text-tertiary);font-weight:500;text-transform:uppercase;letter-spacing:0.06em}

.sidebar-nav{flex:1;padding:0.75rem 0.5rem;overflow-y:auto;scrollbar-width:none}
.sidebar-nav::-webkit-scrollbar{display:none}

.nav-section{margin-bottom:1rem}
.nav-label{
  font-size:0.58rem;font-weight:700;color:var(--text-tertiary);
  text-transform:uppercase;letter-spacing:0.1em;
  padding:0.5rem 0.75rem 0.35rem;
  white-space:nowrap;overflow:hidden;
}
.sidebar.collapsed .nav-label{opacity:0;height:0;padding:0;margin:0}

.nav-item{
  display:flex;align-items:center;gap:0.65rem;
  padding:0.55rem 0.75rem;border-radius:var(--radius-sm);
  color:var(--text-secondary);font-size:0.8rem;font-weight:500;
  cursor:pointer;transition:all 0.2s var(--ease-out);
  white-space:nowrap;position:relative;margin-bottom:2px;
}
.nav-item:hover{background:rgba(255,255,255,0.05);color:var(--text-primary)}
.nav-item.active{background:rgba(139,92,246,0.1);color:#c4b5fd;border:1px solid rgba(139,92,246,0.12)}
.nav-item.active::before{content:"";position:absolute;left:0;top:20%;bottom:20%;width:3px;border-radius:0 2px 2px 0;background:var(--accent-purple);box-shadow:0 0 8px rgba(139,92,246,0.5)}
.nav-icon{width:20px;height:20px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:0.95rem}
.nav-text{overflow:hidden;transition:opacity 0.2s}
.sidebar.collapsed .nav-text{opacity:0;width:0}
.nav-badge{
  margin-left:auto;font-size:0.58rem;font-weight:700;
  padding:0.1rem 0.4rem;border-radius:6px;
  background:rgba(139,92,246,0.15);color:#a78bfa;
  min-width:18px;text-align:center;
}
.sidebar.collapsed .nav-badge{display:none}

.sidebar-footer{
  padding:0.75rem;border-top:1px solid rgba(255,255,255,0.05);
  display:flex;align-items:center;gap:0.5rem;flex-shrink:0;
}
.sidebar-toggle{
  width:32px;height:32px;border-radius:8px;border:none;
  background:rgba(255,255,255,0.05);color:var(--text-tertiary);
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:1rem;transition:all 0.2s;
}
.sidebar-toggle:hover{background:rgba(255,255,255,0.1);color:var(--text-primary)}
.sidebar-version{font-size:0.6rem;color:var(--text-tertiary);overflow:hidden;white-space:nowrap}
.sidebar.collapsed .sidebar-version{opacity:0;width:0}

/* ========== MAIN CONTENT ========== */
.main-content{
  flex:1;margin-left:var(--sidebar-w);
  transition:margin-left 0.3s var(--ease-smooth);
  min-height:100vh;
}
.sidebar.collapsed ~ .main-content{margin-left:var(--sidebar-collapsed)}

/* ========== TOP BAR ========== */
.topbar{
  height:var(--header-h);display:flex;align-items:center;
  padding:0 1.5rem;gap:0.75rem;
  border-bottom:1px solid rgba(255,255,255,0.04);
  background:rgba(6,6,16,0.7);backdrop-filter:blur(20px) saturate(130%);
  position:sticky;top:0;z-index:50;
}
.topbar-left{display:flex;align-items:center;gap:0.75rem;flex:1}
.breadcrumb{display:flex;align-items:center;gap:0.35rem;font-size:0.75rem;color:var(--text-tertiary)}
.breadcrumb-active{color:var(--text-primary);font-weight:600}

.cmd-trigger{
  display:flex;align-items:center;gap:0.5rem;
  padding:0.4rem 0.85rem;border-radius:var(--radius-sm);
  background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);
  color:var(--text-tertiary);font-size:0.75rem;cursor:pointer;
  transition:all 0.2s;min-width:200px;
}
.cmd-trigger:hover{background:rgba(255,255,255,0.07);color:var(--text-secondary);border-color:rgba(255,255,255,0.12)}
.cmd-trigger kbd{font-size:0.6rem;padding:0.1rem 0.35rem;border-radius:4px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);font-family:'JetBrains Mono',monospace;margin-left:auto}

.topbar-right{display:flex;align-items:center;gap:0.6rem}
.status-pill{
  display:inline-flex;align-items:center;gap:0.45rem;
  padding:0.35rem 0.8rem;border-radius:9999px;
  font-size:0.72rem;font-weight:600;
  background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);
}
.status-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;position:relative}
.status-dot::after{content:"";position:absolute;inset:-3px;border-radius:50%;animation:pulse-ring 2s ease-in-out infinite}
.status-dot.green{background:#34d399;box-shadow:0 0 8px #34d399}
.status-dot.green::after{border:1px solid rgba(52,211,153,0.4)}
.status-dot.red{background:#f87171;box-shadow:0 0 8px #f87171}
.status-dot.red::after{border:1px solid rgba(248,113,113,0.4)}
.status-dot.amber{background:#fbbf24;box-shadow:0 0 8px #fbbf24}
.status-dot.amber::after{border:1px solid rgba(251,191,36,0.4)}
@keyframes pulse-ring{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0;transform:scale(1.8)}}

.sys-badge{font-size:0.62rem;color:var(--text-tertiary);padding:0.2rem 0.5rem;border-radius:6px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);font-family:'JetBrains Mono',monospace}
.meta-time{font-size:0.65rem;color:var(--text-tertiary);font-variant-numeric:tabular-nums}

.topbar-btn{
  width:34px;height:34px;border-radius:var(--radius-sm);border:1px solid rgba(255,255,255,0.07);
  background:rgba(255,255,255,0.04);color:var(--text-secondary);
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:0.85rem;transition:all 0.2s var(--ease-out);position:relative;
}
.topbar-btn:hover{background:rgba(255,255,255,0.08);color:var(--text-primary)}
.topbar-btn:active{transform:scale(0.95)}
.topbar-btn .notif-dot{position:absolute;top:5px;right:5px;width:6px;height:6px;border-radius:50%;background:var(--accent-rose);box-shadow:0 0 6px var(--accent-rose)}

/* ========== PAGE CONTAINER ========== */
.page{padding:1.25rem 1.5rem;max-width:1400px;width:100%}
.page-section{display:none}
.page-section.active{display:block}

/* ========== CARDS ========== */
.card{
  background:var(--glass);backdrop-filter:blur(20px) saturate(140%);-webkit-backdrop-filter:blur(20px) saturate(140%);
  border:1px solid var(--glass-border);border-radius:var(--radius-lg);padding:1.5rem;
  position:relative;overflow:hidden;
  transition:border-color 0.3s var(--ease-out),box-shadow 0.4s var(--ease-out),background 0.3s var(--ease-out);
}
.card:hover{background:var(--glass-hover);border-color:rgba(255,255,255,0.1);box-shadow:0 0 0 1px rgba(139,92,246,0.05),0 8px 32px -8px rgba(0,0,0,0.3)}
.card::before{content:"";position:absolute;inset:0;background:radial-gradient(600px circle at var(--mouse-x,50%) var(--mouse-y,50%),rgba(139,92,246,0.04),transparent 40%);pointer-events:none;opacity:0;transition:opacity 0.5s var(--ease-out);z-index:0}
.card:hover::before{opacity:1}
.card>*{position:relative;z-index:1}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.25rem}
.card-title{font-size:0.78rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.08em;display:flex;align-items:center;gap:0.5rem}
.card-count{font-size:0.7rem;color:var(--text-tertiary);font-variant-numeric:tabular-nums;padding:0.15rem 0.5rem;border-radius:6px;background:rgba(255,255,255,0.04)}

/* ========== STAT CARDS ========== */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:0.75rem;margin-bottom:1.25rem}
.stat-card{text-align:center;padding:1.25rem 0.75rem 1rem;position:relative}
.stat-card .stat-icon{width:40px;height:40px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-size:1.1rem;margin-bottom:0.6rem;position:relative}
.stat-card:nth-child(1) .stat-icon{background:rgba(139,92,246,0.12);box-shadow:0 0 20px rgba(139,92,246,0.1)}
.stat-card:nth-child(2) .stat-icon{background:rgba(59,130,246,0.12);box-shadow:0 0 20px rgba(59,130,246,0.1)}
.stat-card:nth-child(3) .stat-icon{background:rgba(16,185,129,0.12);box-shadow:0 0 20px rgba(16,185,129,0.1)}
.stat-card:nth-child(4) .stat-icon{background:rgba(245,158,11,0.12);box-shadow:0 0 20px rgba(245,158,11,0.1)}
.stat-card:nth-child(5) .stat-icon{background:rgba(236,72,153,0.12);box-shadow:0 0 20px rgba(236,72,153,0.1)}
.stat-card:nth-child(6) .stat-icon{background:rgba(255,98,0,0.12);box-shadow:0 0 20px rgba(255,98,0,0.1)}
.stat-card:nth-child(7) .stat-icon{background:rgba(6,182,212,0.12);box-shadow:0 0 20px rgba(6,182,212,0.1)}
.stat-card:nth-child(8) .stat-icon{background:rgba(168,85,247,0.12);box-shadow:0 0 20px rgba(168,85,247,0.1)}
.stat-value{font-size:clamp(1.75rem,3vw,2.5rem);font-weight:800;line-height:1.1;letter-spacing:-0.03em;margin-bottom:0.25rem;font-variant-numeric:tabular-nums;transition:color 0.3s var(--ease-out)}
.stat-card:nth-child(1) .stat-value{color:#c4b5fd}
.stat-card:nth-child(2) .stat-value{color:#93c5fd}
.stat-card:nth-child(3) .stat-value{color:#6ee7b7}
.stat-card:nth-child(4) .stat-value{color:#fcd34d}
.stat-card:nth-child(5) .stat-value{color:#f9a8d4}
.stat-card:nth-child(6) .stat-value{color:#ff8c40}
.stat-card:nth-child(7) .stat-value{color:#67e8f9}
.stat-card:nth-child(8) .stat-value{color:#c4b5fd}
/* Stat card hover glow */
.stat-card{transition:background 0.3s var(--ease-out),border-color 0.3s var(--ease-out),box-shadow 0.4s var(--ease-out)}
.stat-card:nth-child(1):hover{box-shadow:0 0 24px rgba(139,92,246,0.1)}
.stat-card:nth-child(2):hover{box-shadow:0 0 24px rgba(59,130,246,0.1)}
.stat-card:nth-child(3):hover{box-shadow:0 0 24px rgba(16,185,129,0.1)}
.stat-card:nth-child(4):hover{box-shadow:0 0 24px rgba(245,158,11,0.1)}
.stat-card:nth-child(5):hover{box-shadow:0 0 24px rgba(236,72,153,0.1)}
.stat-card:nth-child(6):hover{box-shadow:0 0 24px rgba(255,98,0,0.1)}
.stat-card:nth-child(7):hover{box-shadow:0 0 24px rgba(6,182,212,0.1)}
.stat-card:nth-child(8):hover{box-shadow:0 0 24px rgba(168,85,247,0.1)}
.stat-label{font-size:0.7rem;color:var(--text-tertiary);font-weight:500}
.stat-sub{font-size:0.65rem;color:var(--text-tertiary);margin-top:0.2rem;opacity:0.7}
/* Sparkline in stat cards */
.sparkline{display:flex;align-items:flex-end;gap:2px;height:24px;margin-top:0.5rem;justify-content:center}
.sparkline-bar{width:4px;border-radius:2px;background:rgba(255,255,255,0.06);transition:height 0.5s var(--ease-out)}

/* ========== CURRENT BUILD ========== */
.current-build-card{position:relative;margin-bottom:1.25rem;isolation:isolate;border:none;background:transparent;padding:0}
.current-build-card::before{content:"";position:absolute;inset:0;border-radius:var(--radius-lg);padding:1.5px;background:conic-gradient(from var(--border-angle,0deg),transparent 20%,var(--accent-purple) 40%,var(--accent-cyan) 60%,transparent 80%);-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;animation:rotate-border 3s linear infinite;opacity:0;transition:opacity 0.6s var(--ease-out)}
.current-build-card.active::before{opacity:1}
@property --border-angle{syntax:"<angle>";initial-value:0deg;inherits:false}
@keyframes rotate-border{to{--border-angle:360deg}}
.current-build-inner{background:var(--glass);backdrop-filter:blur(20px) saturate(140%);border:1px solid var(--glass-border);border-radius:var(--radius-lg);padding:1.5rem;position:relative;transition:all 0.4s var(--ease-out)}
.current-build-card.active .current-build-inner{border-color:rgba(139,92,246,0.15);background:rgba(139,92,246,0.04);box-shadow:0 0 40px rgba(139,92,246,0.06)}
.build-active{display:flex;align-items:center;gap:1.25rem}
.build-spinner{width:44px;height:44px;border-radius:50%;flex-shrink:0;border:3px solid rgba(255,255,255,0.06);border-top-color:var(--accent-purple);border-right-color:var(--accent-cyan);animation:spin-smooth 0.9s linear infinite;box-shadow:0 0 16px rgba(139,92,246,0.12)}
@keyframes spin-smooth{to{transform:rotate(360deg)}}
.build-info h3{font-size:1.1rem;font-weight:700;margin-bottom:0.2rem}
.build-info p{font-size:0.75rem;color:var(--text-secondary)}
.build-progress{margin-top:1rem;height:2px;background:rgba(255,255,255,0.04);border-radius:1px;overflow:hidden}
.build-progress-bar{height:100%;width:30%;border-radius:1px;background:linear-gradient(90deg,var(--accent-purple),var(--accent-cyan));animation:progress-indeterminate 2.2s var(--ease-in-out) infinite}
@keyframes progress-indeterminate{0%{width:8%;margin-left:0}50%{width:35%;margin-left:30%}100%{width:8%;margin-left:92%}}
.build-idle{text-align:center;padding:1.5rem 1rem}
.idle-icon{font-size:2.5rem;margin-bottom:0.5rem;animation:float-gentle 5s var(--ease-in-out) infinite;filter:grayscale(0.2)}
@keyframes float-gentle{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.idle-text{font-size:0.85rem;color:var(--text-tertiary);font-weight:500}
.idle-sub{font-size:0.7rem;color:var(--text-tertiary);opacity:0.6;margin-top:0.25rem}

/* ========== MAIN GRID ========== */
.main-grid{display:grid;grid-template-columns:1.3fr 1fr;gap:1.25rem}

/* ========== TERMINAL ========== */
.terminal{border-radius:var(--radius-lg);overflow:hidden}
.terminal-header{display:flex;align-items:center;gap:0.5rem;padding:0.75rem 1rem;background:rgba(255,255,255,0.025);border-bottom:1px solid rgba(255,255,255,0.04)}
.terminal-dots{display:flex;gap:6px}
.terminal-dots span{width:10px;height:10px;border-radius:50%;transition:opacity 0.2s}
.terminal-dots span:nth-child(1){background:#ff5f57;box-shadow:0 0 4px rgba(255,95,87,0.3)}
.terminal-dots span:nth-child(2){background:#febc2e;box-shadow:0 0 4px rgba(254,188,46,0.3)}
.terminal-dots span:nth-child(3){background:#28c840;box-shadow:0 0 4px rgba(40,200,64,0.3)}
.terminal-title{flex:1;text-align:center;font-size:0.7rem;color:var(--text-tertiary);font-family:'JetBrains Mono',monospace}
.terminal-badge{font-size:0.6rem;font-weight:600;padding:0.15rem 0.5rem;border-radius:4px;background:rgba(52,211,153,0.1);color:#34d399;text-transform:uppercase;letter-spacing:0.05em}
.log-viewer{background:rgba(0,0,0,0.3);padding:1rem;max-height:460px;overflow-y:auto;font-family:'JetBrains Mono',ui-monospace,monospace;font-size:0.68rem;line-height:1.8}
.log-line{white-space:pre-wrap;word-break:break-all;padding:0.15rem 0;border-left:2px solid transparent;padding-left:0.75rem;transition:border-color 0.15s var(--ease-out),background 0.15s var(--ease-out)}
.log-line:hover{background:rgba(255,255,255,0.025);border-left-color:rgba(255,255,255,0.1)}
.log-info{color:#8892a4}.log-error{color:#f87171;font-weight:600;border-left-color:rgba(248,113,113,0.4)}
.log-warn{color:#fbbf24;border-left-color:rgba(251,191,36,0.3)}
.log-success{color:#34d399;border-left-color:rgba(52,211,153,0.3)}
.log-build{color:#a78bfa;font-weight:600;border-left-color:rgba(167,139,250,0.4)}
.log-deploy{color:#60a5fa;border-left-color:rgba(96,165,250,0.3)}
.log-reddit{color:#ff6200;border-left-color:rgba(255,98,0,0.4)}
/* Agent-specific log colors */
.log-research{color:#f59e0b;border-left-color:rgba(245,158,11,0.5)}
.log-validation{color:#ef4444;border-left-color:rgba(239,68,68,0.5)}
.log-frontend{color:#3b82f6;border-left-color:rgba(59,130,246,0.5)}
.log-backend{color:#10b981;border-left-color:rgba(16,185,129,0.5)}
.log-pm{color:#8b5cf6;border-left-color:rgba(139,92,246,0.5)}
.log-agent-badge{display:inline-block;font-size:0.58rem;font-weight:700;padding:0.06rem 0.35rem;border-radius:3px;margin-right:0.4rem;letter-spacing:0.03em}
.log-timestamp{color:var(--text-tertiary);margin-right:0.4rem;font-size:0.62rem;opacity:0.7}
.log-phase-separator{text-align:center;color:var(--text-tertiary);padding:0.4rem 0;font-weight:700;letter-spacing:0.12em;border-left-color:rgba(139,92,246,0.3) !important;background:rgba(139,92,246,0.03)}
/* Log filter bar */
.log-filter-bar{display:flex;gap:0.25rem;padding:0.5rem 1rem;background:rgba(255,255,255,0.02);border-bottom:1px solid rgba(255,255,255,0.04);flex-wrap:wrap}
.log-filter-btn{padding:0.3rem 0.6rem;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.03);color:var(--text-tertiary);font-size:0.62rem;font-weight:600;font-family:inherit;cursor:pointer;border-radius:6px;transition:all 0.2s}
.log-filter-btn.active{background:rgba(139,92,246,0.12);color:#c4b5fd;border-color:rgba(139,92,246,0.25)}
.log-filter-btn:hover:not(.active){background:rgba(255,255,255,0.06);color:var(--text-secondary)}
.log-filter-btn[data-agent="RA"]{--fc:#f59e0b}.log-filter-btn[data-agent="VA"]{--fc:#ef4444}.log-filter-btn[data-agent="FA"]{--fc:#3b82f6}.log-filter-btn[data-agent="BA"]{--fc:#10b981}.log-filter-btn[data-agent="PM"]{--fc:#8b5cf6}
.log-filter-btn[data-agent].active{background:color-mix(in srgb,var(--fc) 15%,transparent);color:var(--fc);border-color:color-mix(in srgb,var(--fc) 30%,transparent)}

/* Pipeline activity banner */
.pipeline-activity{display:flex;align-items:center;gap:0.75rem;padding:0.75rem 1rem;background:rgba(139,92,246,0.08);border:1px solid rgba(139,92,246,0.2);border-radius:var(--radius-sm);margin-bottom:1rem;animation:fade-in-up 0.3s var(--ease-out-expo)}
.pipeline-activity.researching{background:rgba(245,158,11,0.08);border-color:rgba(245,158,11,0.2)}
.pipeline-activity.validating{background:rgba(239,68,68,0.08);border-color:rgba(239,68,68,0.2)}
.pipeline-activity.building{background:rgba(16,185,129,0.08);border-color:rgba(16,185,129,0.2)}
.pa-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;animation:pulse 1.5s infinite}
.pipeline-activity.researching .pa-dot{background:#f59e0b}
.pipeline-activity.validating .pa-dot{background:#ef4444}
.pipeline-activity.building .pa-dot{background:#10b981}
.pipeline-activity.idle .pa-dot{background:#6b7280;animation:none}
.pa-text{flex:1;font-size:0.72rem}
.pa-phase{font-weight:700;text-transform:uppercase;font-size:0.6rem;letter-spacing:0.08em;opacity:0.7;display:block;margin-bottom:0.1rem}
.pa-detail{opacity:0.85}
.pa-count{font-size:0.65rem;font-weight:600;padding:0.15rem 0.5rem;border-radius:4px;background:rgba(255,255,255,0.06);flex-shrink:0}

/* ========== SIDEBAR STACK / PIPELINE ========== */
.sidebar-stack{display:flex;flex-direction:column;gap:1.25rem}
.tabs{display:flex;gap:0.25rem;background:rgba(255,255,255,0.03);border-radius:var(--radius-sm);padding:3px;margin-bottom:0.75rem}
.tab-btn{flex:1;padding:0.45rem 0.75rem;border:none;background:transparent;color:var(--text-tertiary);font-size:0.72rem;font-weight:600;font-family:inherit;cursor:pointer;border-radius:8px;transition:all 0.25s var(--ease-smooth)}
.tab-btn.active{background:rgba(255,255,255,0.08);color:var(--text-primary);box-shadow:0 2px 8px rgba(0,0,0,0.15)}
.tab-btn:hover:not(.active){color:var(--text-secondary)}
.list-scroll{max-height:400px;overflow-y:auto;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,0.06) transparent}
.list-scroll::-webkit-scrollbar{width:4px}
.list-scroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.06);border-radius:2px}
.list-item{padding:0.65rem 0.5rem;border-bottom:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;gap:0.65rem;border-radius:var(--radius-sm);transition:background 0.2s;cursor:default}
.list-item:hover{background:rgba(255,255,255,0.03)}
.list-item:last-child{border-bottom:none}
.list-rank{font-size:0.65rem;font-weight:700;color:var(--text-tertiary);width:18px;text-align:center;flex-shrink:0;font-variant-numeric:tabular-nums}
.list-info{flex:1;min-width:0}
.list-title{font-size:0.8rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.list-meta{font-size:0.65rem;color:var(--text-tertiary);margin-top:0.15rem;display:flex;align-items:center;gap:0.5rem;flex-wrap:wrap}
.badge{padding:0.12rem 0.5rem;border-radius:6px;font-size:0.6rem;font-weight:700;text-transform:uppercase;letter-spacing:0.04em;flex-shrink:0;backdrop-filter:blur(4px)}
.badge-web{background:rgba(59,130,246,0.12);color:#60a5fa;border:1px solid rgba(59,130,246,0.2)}
.badge-saas{background:rgba(139,92,246,0.12);color:#a78bfa;border:1px solid rgba(139,92,246,0.2)}
.badge-mobile{background:rgba(16,185,129,0.12);color:#34d399;border:1px solid rgba(16,185,129,0.2)}
.badge-extension{background:rgba(245,158,11,0.12);color:#fbbf24;border:1px solid rgba(245,158,11,0.2)}
.badge-api{background:rgba(236,72,153,0.12);color:#f472b6;border:1px solid rgba(236,72,153,0.2)}
.score-wrap{display:flex;align-items:center;gap:0.4rem;flex-shrink:0}
.score-num{font-size:0.6rem;font-weight:700;color:var(--text-tertiary);font-variant-numeric:tabular-nums;width:14px;text-align:right}
.score-bar{width:52px;height:4px;background:rgba(255,255,255,0.06);border-radius:2px;overflow:hidden}
.score-fill{height:100%;border-radius:2px;transition:width 0.6s var(--ease-out)}
.score-high{background:linear-gradient(90deg,#34d399,#10b981)}
.score-mid{background:linear-gradient(90deg,#60a5fa,#3b82f6)}
.score-low{background:linear-gradient(90deg,#fbbf24,#f59e0b)}
.link-row{display:flex;gap:0.3rem;flex-shrink:0;align-items:center}
.link-btn{display:inline-flex;align-items:center;gap:0.28rem;padding:0.2rem 0.45rem;border-radius:6px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.09);color:var(--text-secondary);text-decoration:none;font-size:0.56rem;font-weight:600;letter-spacing:0.02em;transition:all 0.18s var(--ease-out);white-space:nowrap}
.link-btn svg{flex-shrink:0;width:11px;height:11px;opacity:0.75}
.link-btn:hover{color:var(--text-primary);transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,0.3)}
.link-btn-gh:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.22)}
.link-btn-vercel:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.22)}
.link-btn-gh svg,.link-btn-vercel svg{opacity:0.9}
.link-live-dot{display:inline-block;width:5px;height:5px;border-radius:50%;background:#34d399;box-shadow:0 0 5px #34d399;flex-shrink:0}
.source-tag{font-size:0.52rem;font-weight:700;padding:0.06rem 0.35rem;border-radius:3px;text-transform:uppercase;letter-spacing:0.04em}
.source-reddit{background:rgba(255,98,0,0.1);color:#ff6200;border:1px solid rgba(255,98,0,0.2)}
.source-ai{background:rgba(139,92,246,0.1);color:#a78bfa;border:1px solid rgba(139,92,246,0.2)}
.source-hackernews{background:rgba(255,102,0,0.1);color:#ff6600;border:1px solid rgba(255,102,0,0.2)}
.source-devto{background:rgba(59,130,246,0.1);color:#60a5fa;border:1px solid rgba(59,130,246,0.2)}
/* Live feed */
.live-feed-header{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.75rem}
.live-dot{width:7px;height:7px;border-radius:50%;background:#34d399;box-shadow:0 0 8px #34d399;animation:pulse-dot 1.5s ease-in-out infinite}
@keyframes pulse-dot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(0.7)}}
.live-label{font-size:0.6rem;font-weight:700;color:#34d399;text-transform:uppercase;letter-spacing:0.08em}
.source-tabs{display:flex;gap:0.35rem;flex-wrap:wrap;margin-bottom:0.75rem}
.source-tab{font-size:0.6rem;font-weight:700;padding:0.2rem 0.6rem;border-radius:5px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.04);color:var(--text-tertiary);cursor:pointer;transition:all 0.15s}
.source-tab.active,.source-tab:hover{background:rgba(255,255,255,0.1);color:var(--text-primary);border-color:rgba(255,255,255,0.2)}
.source-tab.src-all.active{background:rgba(139,92,246,0.15);color:#a78bfa;border-color:rgba(139,92,246,0.3)}
.source-tab.src-reddit.active{background:rgba(255,98,0,0.12);color:#ff6200;border-color:rgba(255,98,0,0.3)}
.source-tab.src-hackernews.active{background:rgba(255,102,0,0.12);color:#ff6600;border-color:rgba(255,102,0,0.3)}
.source-tab.src-devto.active{background:rgba(59,130,246,0.12);color:#60a5fa;border-color:rgba(59,130,246,0.3)}
.signal-item-new{animation:slide-in-signal 0.45s var(--ease-out-expo) both}
@keyframes slide-in-signal{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:translateX(0)}}
.source-counts{display:flex;gap:0.5rem;font-size:0.6rem;color:var(--text-tertiary);flex-wrap:wrap}

/* ========== ARCHITECTURE PAGE ========== */
.arch-header{margin-bottom:1.5rem}
.arch-header h2{font-size:1.4rem;font-weight:800;letter-spacing:-0.03em;margin-bottom:0.25rem}
.arch-header p{font-size:0.78rem;color:var(--text-secondary)}
.arch-live-bar{display:flex;align-items:center;gap:0.5rem;margin-top:0.5rem;font-size:0.68rem;color:var(--text-tertiary);min-height:20px}
.arch-pipeline{display:flex;flex-direction:column;align-items:center;gap:0;margin-bottom:1.5rem;max-width:820px;margin-left:auto;margin-right:auto}
.arch-node{width:100%;background:var(--glass);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--radius-lg);padding:1.1rem 1.25rem;display:flex;align-items:center;gap:1rem;position:relative;transition:all 0.4s var(--ease-out)}
.arch-node.active-research{border-color:rgba(245,158,11,0.35);background:rgba(245,158,11,0.04);box-shadow:0 0 30px rgba(245,158,11,0.08)}
.arch-node.active-validating{border-color:rgba(239,68,68,0.35);background:rgba(239,68,68,0.04);box-shadow:0 0 30px rgba(239,68,68,0.08)}
.arch-node.active-building{border-color:rgba(16,185,129,0.35);background:rgba(16,185,129,0.04);box-shadow:0 0 30px rgba(16,185,129,0.08)}
.arch-node.active-pm{border-color:rgba(139,92,246,0.35);background:rgba(139,92,246,0.04);box-shadow:0 0 30px rgba(139,92,246,0.08)}
.arch-node.step-done{opacity:0.55}
.arch-node-icon{font-size:1.4rem;flex-shrink:0;width:40px;text-align:center}
.arch-node-body{flex:1;min-width:0}
.arch-node-title{font-size:0.88rem;font-weight:700;margin-bottom:0.12rem}
.arch-node-desc{font-size:0.68rem;color:var(--text-secondary);line-height:1.55}
.arch-node-tags{display:flex;flex-wrap:wrap;gap:0.3rem;margin-top:0.45rem}
.arch-tag{font-size:0.57rem;font-weight:700;padding:0.1rem 0.42rem;border-radius:5px;text-transform:uppercase;letter-spacing:0.03em}
.arch-tag-amber{background:rgba(245,158,11,0.12);color:#f59e0b;border:1px solid rgba(245,158,11,0.2)}
.arch-tag-red{background:rgba(239,68,68,0.12);color:#ef4444;border:1px solid rgba(239,68,68,0.2)}
.arch-tag-blue{background:rgba(59,130,246,0.12);color:#60a5fa;border:1px solid rgba(59,130,246,0.2)}
.arch-tag-green{background:rgba(16,185,129,0.12);color:#10b981;border:1px solid rgba(16,185,129,0.2)}
.arch-tag-purple{background:rgba(139,92,246,0.12);color:#a78bfa;border:1px solid rgba(139,92,246,0.2)}
.arch-tag-orange{background:rgba(255,98,0,0.12);color:#ff6200;border:1px solid rgba(255,98,0,0.2)}
.arch-node-stat{font-size:0.7rem;font-weight:700;color:var(--text-tertiary);flex-shrink:0;text-align:right;min-width:60px;font-variant-numeric:tabular-nums}
.arch-node-status{position:absolute;top:0.6rem;right:0.75rem;font-size:0.58rem;font-weight:700;padding:0.12rem 0.45rem;border-radius:4px;text-transform:uppercase;letter-spacing:0.04em;transition:all 0.3s}
.arch-node-status.s-research{background:rgba(245,158,11,0.15);color:#f59e0b;animation:pulse-fade 1.5s ease-in-out infinite}
.arch-node-status.s-validating{background:rgba(239,68,68,0.15);color:#ef4444;animation:pulse-fade 1.5s ease-in-out infinite}
.arch-node-status.s-building{background:rgba(16,185,129,0.15);color:#10b981;animation:pulse-fade 1.5s ease-in-out infinite}
.arch-node-status.s-pm{background:rgba(139,92,246,0.15);color:#a78bfa;animation:pulse-fade 1.5s ease-in-out infinite}
.arch-node-status.s-done{background:rgba(16,185,129,0.08);color:#6ee7b7}
.arch-node-status.s-idle{background:rgba(107,114,128,0.08);color:#6b7280}
@keyframes pulse-fade{0%,100%{opacity:1}50%{opacity:0.45}}
.arch-arrow{width:2px;height:26px;background:linear-gradient(to bottom,rgba(255,255,255,0.08),rgba(255,255,255,0.02));margin:0 auto;position:relative;flex-shrink:0}
.arch-arrow::after{content:"â–¾";position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);font-size:0.7rem;color:rgba(255,255,255,0.12)}
.arch-parallel-row{display:grid;grid-template-columns:1fr 48px 1fr;gap:0.6rem;width:100%;align-items:stretch}
.arch-node-build{width:100%}
.arch-parallel-sep{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.25rem;font-size:0.5rem;color:var(--text-tertiary);font-weight:700;text-transform:uppercase;letter-spacing:0.08em}
.arch-parallel-line{width:1px;height:100%;background:rgba(255,255,255,0.05);flex:1}
.arch-tech-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.arch-tech-grid{display:grid;grid-template-columns:1fr 1fr;gap:0.45rem}
.arch-tech-item{display:flex;flex-direction:column;gap:0.08rem;padding:0.45rem 0.65rem;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
.arch-tech-name{font-size:0.56rem;color:var(--text-tertiary);font-weight:600;text-transform:uppercase;letter-spacing:0.06em}
.arch-tech-val{font-size:0.7rem;color:var(--text-primary);font-weight:600}
.arch-cycle-step{display:flex;align-items:baseline;gap:0.5rem;font-size:0.72rem;color:var(--text-secondary);line-height:1.9}
.arch-cycle-step strong{color:var(--text-primary)}
.arch-cycle-num{font-size:0.58rem;font-weight:800;color:var(--text-tertiary);background:rgba(255,255,255,0.04);border-radius:4px;padding:0.1rem 0.35rem;flex-shrink:0}

/* ========== SQUADRON AGENTS ========== */
.squadron-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:0.75rem;margin-bottom:1.25rem}
.agent-card{text-align:center;padding:1.25rem 0.75rem}
.agent-avatar{
  width:48px;height:48px;border-radius:14px;margin:0 auto 0.65rem;
  display:flex;align-items:center;justify-content:center;
  font-size:0.85rem;font-weight:800;letter-spacing:-0.02em;
  position:relative;
  transition:transform 0.25s var(--ease-out);
}
.agent-card:hover .agent-avatar{transform:scale(1.06)}
.agent-avatar::after{content:"";position:absolute;bottom:-2px;right:-2px;width:12px;height:12px;border-radius:50%;border:2px solid var(--bg-deep)}
.agent-avatar.online::after{background:#34d399;box-shadow:0 0 6px #34d399}
.agent-avatar.idle::after{background:#fbbf24;box-shadow:0 0 6px #fbbf24}
.agent-avatar.offline::after{background:#f87171;box-shadow:0 0 6px #f87171}
.agent-name{font-size:0.8rem;font-weight:700;margin-bottom:0.15rem}
.agent-role{font-size:0.65rem;color:var(--text-tertiary);font-weight:500;text-transform:uppercase;letter-spacing:0.06em}
.agent-wallet{font-size:0.58rem;color:var(--text-tertiary);font-family:'JetBrains Mono',monospace;margin-top:0.3rem;opacity:0.6}

/* ========== CLAWHUB SKILLS ========== */
.skills-page-header{margin-bottom:1.5rem}
.skills-top-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;gap:1rem;flex-wrap:wrap}
.skills-top-row h3{font-size:1.15rem;font-weight:800;display:flex;align-items:center;gap:0.5rem;white-space:nowrap}
.skills-top-row h3 span{font-size:1.2rem}
.skills-search-wrap{
  display:flex;align-items:center;gap:0.5rem;flex:1;max-width:400px;
  padding:0.45rem 0.85rem;border-radius:var(--radius-sm);
  background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);
  transition:all 0.2s;
}
.skills-search-wrap:focus-within{border-color:rgba(139,92,246,0.3);background:rgba(255,255,255,0.06);box-shadow:0 0 20px rgba(139,92,246,0.08)}
.skills-search-wrap svg{width:14px;height:14px;color:var(--text-tertiary);flex-shrink:0}
.skills-search{flex:1;background:none;border:none;color:var(--text-primary);font-size:0.78rem;font-family:inherit;outline:none}
.skills-search::placeholder{color:var(--text-tertiary)}
.skills-sort{display:flex;align-items:center;gap:0.35rem}
.sort-btn{padding:0.35rem 0.65rem;border:none;background:rgba(255,255,255,0.03);color:var(--text-tertiary);font-size:0.65rem;font-weight:600;font-family:inherit;cursor:pointer;border-radius:7px;transition:all 0.2s;border:1px solid transparent}
.sort-btn.active{background:rgba(139,92,246,0.1);color:#c4b5fd;border-color:rgba(139,92,246,0.2)}
.sort-btn:hover:not(.active){color:var(--text-secondary);background:rgba(255,255,255,0.05)}
.skills-categories{display:flex;gap:0.3rem;overflow-x:auto;padding-bottom:0.5rem;scrollbar-width:none;-webkit-overflow-scrolling:touch;margin-bottom:0.25rem}
.skills-categories::-webkit-scrollbar{display:none}
.cat-pill{
  padding:0.35rem 0.75rem;border-radius:9999px;border:none;
  background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);
  color:var(--text-tertiary);font-size:0.65rem;font-weight:600;font-family:inherit;
  cursor:pointer;transition:all 0.2s;white-space:nowrap;flex-shrink:0;
}
.cat-pill.active{background:rgba(139,92,246,0.12);color:#c4b5fd;border-color:rgba(139,92,246,0.25)}
.cat-pill:hover:not(.active){background:rgba(255,255,255,0.06);color:var(--text-secondary)}
.cat-pill .cat-count{font-size:0.55rem;margin-left:0.25rem;opacity:0.6}
.skills-stats-row{display:flex;gap:1rem;margin-bottom:1.25rem;flex-wrap:wrap}
.skills-stat{display:flex;align-items:center;gap:0.4rem;font-size:0.7rem;color:var(--text-tertiary)}
.skills-stat strong{color:var(--text-primary);font-weight:700;font-variant-numeric:tabular-nums}
.skills-featured{margin-bottom:1.5rem}
.skills-featured-title{font-size:0.72rem;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:0.75rem;display:flex;align-items:center;gap:0.4rem}
.featured-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:0.75rem}
.skills-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}
.skills-header h3{font-size:1rem;font-weight:700;display:flex;align-items:center;gap:0.5rem}
.skills-header h3 span{font-size:1.1rem}
.skills-filter{display:flex;gap:0.25rem;background:rgba(255,255,255,0.03);border-radius:var(--radius-sm);padding:3px}
.filter-btn{padding:0.35rem 0.7rem;border:none;background:transparent;color:var(--text-tertiary);font-size:0.68rem;font-weight:600;font-family:inherit;cursor:pointer;border-radius:7px;transition:all 0.2s}
.filter-btn.active{background:rgba(255,255,255,0.08);color:var(--text-primary)}
.filter-btn:hover:not(.active){color:var(--text-secondary)}
.skills-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:0.75rem}
.skill-card{
  display:flex;align-items:flex-start;gap:0.85rem;
  padding:1rem;cursor:pointer;
}
.skill-card:hover{background:rgba(255,255,255,0.06)}
.skill-card.featured-card{border-color:rgba(139,92,246,0.15);background:linear-gradient(135deg,rgba(139,92,246,0.05),rgba(6,182,212,0.03))}
.skill-card.featured-card:hover{border-color:rgba(139,92,246,0.25)}
.skill-icon{
  width:44px;height:44px;border-radius:14px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  font-size:1.15rem;font-weight:800;letter-spacing:-0.02em;
  position:relative;
}
.skill-icon .verified-badge{
  position:absolute;bottom:-2px;right:-2px;width:14px;height:14px;
  border-radius:50%;background:#3b82f6;border:2px solid var(--bg-deep);
  display:flex;align-items:center;justify-content:center;
  font-size:0.45rem;color:#fff;line-height:1;
}
.skill-info{flex:1;min-width:0}
.skill-name{font-size:0.82rem;font-weight:700;display:flex;align-items:center;gap:0.4rem;flex-wrap:wrap}
.skill-desc{font-size:0.68rem;color:var(--text-tertiary);margin-top:0.2rem;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.skill-meta{display:flex;align-items:center;gap:0.6rem;margin-top:0.35rem;font-size:0.6rem;color:var(--text-tertiary);flex-wrap:wrap}
.skill-downloads{display:flex;align-items:center;gap:0.2rem}
.skill-rating{display:flex;align-items:center;gap:0.15rem;color:#fbbf24}
.skill-rating .stars{letter-spacing:1px;font-size:0.55rem}
.skill-rating .rating-num{color:var(--text-tertiary);margin-left:0.15rem}
.skill-version{font-family:'JetBrains Mono',monospace;font-size:0.55rem;opacity:0.6}
.skill-author{opacity:0.7}
.skill-cat-badge{font-size:0.52rem;font-weight:700;padding:0.08rem 0.4rem;border-radius:4px;text-transform:uppercase;letter-spacing:0.04em}
.skill-installed{font-size:0.55rem;font-weight:700;padding:0.15rem 0.5rem;border-radius:5px;background:rgba(16,185,129,0.12);color:#34d399;border:1px solid rgba(16,185,129,0.2);display:inline-flex;align-items:center;gap:0.25rem}
.skill-install-btn{font-size:0.6rem;font-weight:700;padding:0.25rem 0.65rem;border-radius:7px;background:rgba(139,92,246,0.12);color:#a78bfa;border:1px solid rgba(139,92,246,0.2);cursor:pointer;transition:all 0.2s;display:inline-flex;align-items:center;gap:0.25rem}
.skill-install-btn:hover{background:rgba(139,92,246,0.25);box-shadow:0 0 16px rgba(139,92,246,0.15)}

/* ========== SIGNALS ========== */
.signals-section{margin-top:1.25rem}
.signals-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem}
.flow-card{margin-bottom:1.25rem}
.flow-steps{display:flex;align-items:center;justify-content:center;gap:0;padding:1rem 0;flex-wrap:wrap}
.flow-step{display:flex;align-items:center;gap:0.5rem;padding:0.5rem 0.9rem;border-radius:var(--radius-sm);background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);font-size:0.72rem;font-weight:600;color:var(--text-secondary)}
.flow-step.active{background:rgba(255,98,0,0.08);border-color:rgba(255,98,0,0.25);color:#ff6200}
.flow-step.ai{background:rgba(139,92,246,0.08);border-color:rgba(139,92,246,0.25);color:#a78bfa}
.flow-step.build{background:rgba(16,185,129,0.08);border-color:rgba(16,185,129,0.25);color:#34d399}
.flow-arrow{color:var(--text-tertiary);font-size:0.8rem;padding:0 0.25rem;opacity:0.4}
.flow-sub{font-size:0.6rem;color:var(--text-tertiary);text-align:center;margin-top:0.35rem}
.signal-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:0.5rem;margin-bottom:1rem}
.signal-stat{text-align:center;padding:0.6rem 0.4rem;background:rgba(255,255,255,0.02);border-radius:var(--radius-sm);border:1px solid rgba(255,255,255,0.04)}
.signal-stat-val{font-size:1.3rem;font-weight:800;letter-spacing:-0.02em;font-variant-numeric:tabular-nums}
.signal-stat-val.reddit{color:#ff6200}.signal-stat-val.kw{color:#fbbf24}.signal-stat-val.sub{color:#60a5fa}.signal-stat-val.files{color:#34d399}
.signal-stat-lbl{font-size:0.6rem;color:var(--text-tertiary);margin-top:0.1rem}
.signal-item{padding:0.6rem 0.65rem;border-bottom:1px solid rgba(255,255,255,0.04);border-radius:var(--radius-sm);transition:background 0.2s}
.signal-item:hover{background:rgba(255,98,0,0.03)}
.signal-item:last-child{border-bottom:none}
.signal-header{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.3rem}
.signal-sub-badge{font-size:0.58rem;font-weight:700;padding:0.1rem 0.45rem;border-radius:4px;background:rgba(255,98,0,0.1);color:#ff6200;border:1px solid rgba(255,98,0,0.2);flex-shrink:0;white-space:nowrap}
.signal-title{font-size:0.76rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}
.signal-title a{color:inherit;text-decoration:none}
.signal-title a:hover{color:var(--accent-cyan);text-decoration:underline}
.signal-metrics{display:flex;align-items:center;gap:0.6rem;font-size:0.62rem;color:var(--text-tertiary);margin-bottom:0.25rem}
.signal-metric{display:flex;align-items:center;gap:0.2rem}
.signal-metric .up{color:#ff6200;font-weight:700}
.signal-metric .comments{color:#60a5fa;font-weight:600}
.signal-body{font-size:0.65rem;color:var(--text-tertiary);line-height:1.5;margin-bottom:0.3rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.signal-keywords{display:flex;flex-wrap:wrap;gap:0.25rem}
.signal-kw{font-size:0.55rem;font-weight:600;padding:0.08rem 0.35rem;border-radius:3px;background:rgba(251,191,36,0.08);color:#fbbf24;border:1px solid rgba(251,191,36,0.15)}
.sub-chart{display:flex;flex-direction:column;gap:0.3rem;margin-top:0.5rem}
.sub-row{display:flex;align-items:center;gap:0.5rem}
.sub-name{font-size:0.62rem;color:var(--text-secondary);width:100px;text-align:right;flex-shrink:0;font-family:'JetBrains Mono',monospace}
.sub-bar-wrap{flex:1;height:14px;background:rgba(255,255,255,0.03);border-radius:3px;overflow:hidden}
.sub-bar{height:100%;border-radius:3px;background:linear-gradient(90deg,#ff6200,#ff8c40);transition:width 0.7s var(--ease-out)}
.sub-count{font-size:0.6rem;color:var(--text-tertiary);width:24px;font-variant-numeric:tabular-nums;font-family:'JetBrains Mono',monospace}

/* ========== COMMAND PALETTE ========== */
.cmd-overlay{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.55);backdrop-filter:blur(12px);display:none;align-items:flex-start;justify-content:center;padding-top:15vh;animation:overlay-in 0.2s var(--ease-out)}
.cmd-overlay.open{display:flex}
@keyframes overlay-in{from{opacity:0}}
.cmd-modal{width:520px;max-width:90vw;background:rgba(13,13,26,0.96);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-lg);overflow:hidden;box-shadow:0 24px 80px rgba(0,0,0,0.5),0 0 0 1px rgba(139,92,246,0.05);animation:cmd-in 0.25s var(--ease-out-expo)}
@keyframes cmd-in{from{opacity:0;transform:scale(0.97) translateY(-8px)}}
.cmd-input-wrap{padding:0.75rem 1rem;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;align-items:center;gap:0.5rem}
.cmd-input-wrap svg{width:18px;height:18px;color:var(--text-tertiary);flex-shrink:0}
.cmd-input{flex:1;background:none;border:none;color:var(--text-primary);font-size:0.9rem;font-family:inherit;outline:none}
.cmd-input::placeholder{color:var(--text-tertiary)}
.cmd-results{max-height:320px;overflow-y:auto;padding:0.5rem}
.cmd-item{display:flex;align-items:center;gap:0.65rem;padding:0.55rem 0.75rem;border-radius:var(--radius-sm);cursor:pointer;transition:background 0.15s;color:var(--text-secondary);font-size:0.8rem}
.cmd-item:hover,.cmd-item.selected{background:rgba(139,92,246,0.1);color:var(--text-primary)}
.cmd-item-icon{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:0.85rem;background:rgba(255,255,255,0.05);flex-shrink:0}
.cmd-item-text{flex:1}
.cmd-item-hint{font-size:0.62rem;color:var(--text-tertiary)}
.cmd-footer{padding:0.5rem 1rem;border-top:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;gap:1rem;font-size:0.62rem;color:var(--text-tertiary)}
.cmd-footer kbd{font-size:0.58rem;padding:0.08rem 0.3rem;border-radius:3px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);font-family:'JetBrains Mono',monospace}

/* ========== EMPTY / LOADING / TOAST ========== */
.empty{text-align:center;padding:2.5rem 1rem;color:var(--text-tertiary);font-size:0.8rem}
.empty-icon{font-size:2rem;margin-bottom:0.5rem;filter:grayscale(0.3)}
.skeleton{background:linear-gradient(90deg,rgba(255,255,255,0.02) 25%,rgba(255,255,255,0.05) 50%,rgba(255,255,255,0.02) 75%);background-size:200% 100%;animation:shimmer 2s var(--ease-in-out) infinite;border-radius:var(--radius-sm)}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.toast-container{position:fixed;bottom:1.5rem;right:1.5rem;display:flex;flex-direction:column;gap:0.5rem;z-index:1000;pointer-events:none}
.toast{padding:0.6rem 1rem;background:rgba(13,13,26,0.92);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,0.06);border-radius:var(--radius-sm);font-size:0.72rem;font-weight:500;color:var(--text-secondary);box-shadow:0 8px 32px rgba(0,0,0,0.3),0 0 0 1px rgba(139,92,246,0.05);animation:toast-in 0.35s var(--ease-out),toast-out 0.3s var(--ease-in) 2.5s forwards;pointer-events:auto}
@keyframes toast-in{from{opacity:0;transform:translateX(24px)}}
@keyframes toast-out{to{opacity:0;transform:translateX(16px)}}
.footer{text-align:center;padding:2rem 0 1.5rem;font-size:0.65rem;color:var(--text-tertiary)}
.footer a{color:var(--accent-purple);text-decoration:none}
.footer a:hover{text-decoration:underline}

/* ========== ANIMATIONS ========== */
@keyframes fade-in-up{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.ani{animation:fade-in-up 0.5s var(--ease-out) both}
.d1{animation-delay:0.04s}.d2{animation-delay:0.08s}.d3{animation-delay:0.12s}
.d4{animation-delay:0.16s}.d5{animation-delay:0.2s}.d6{animation-delay:0.24s}
.d7{animation-delay:0.28s}.d8{animation-delay:0.32s}
@keyframes count-pop{0%{transform:scale(1)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
.count-changed{animation:count-pop 0.35s var(--ease-spring)}
@keyframes card-live-pulse{0%,100%{box-shadow:0 0 0 0 rgba(139,92,246,0)}50%{box-shadow:0 0 0 3px rgba(139,92,246,0.25)}}
.card-updated{animation:card-live-pulse 0.6s var(--ease-out)}
@keyframes val-glow{0%{text-shadow:0 0 0 transparent}40%{text-shadow:0 0 12px rgba(139,92,246,0.6)}100%{text-shadow:none}}
.stat-value.count-changed{animation:count-pop 0.35s var(--ease-spring),val-glow 0.6s var(--ease-out)}
/* Live indicator dot */
.live-dot{width:7px;height:7px;border-radius:50%;background:#10b981;display:inline-block;margin-right:4px;box-shadow:0 0 0 0 rgba(16,185,129,0.5);animation:live-ping 2s ease-in-out infinite}
.live-dot.disconnected{background:#ef4444;animation:none;box-shadow:none}
@keyframes live-ping{0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,0.5)}50%{box-shadow:0 0 0 5px rgba(16,185,129,0)}}
@keyframes spin{to{transform:rotate(360deg)}}
/* Subtle glow pulse for active elements */
@keyframes glow-pulse{0%,100%{box-shadow:0 0 12px rgba(139,92,246,0.1)}50%{box-shadow:0 0 24px rgba(139,92,246,0.2)}}
/* Fade in for dynamically added content */
@keyframes fade-in{from{opacity:0}to{opacity:1}}
/* Slide in from right for toasts */
@keyframes slide-in-right{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}
.btn-refresh{display:inline-flex;align-items:center;gap:0.4rem;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);color:var(--text-secondary);padding:0.45rem 0.9rem;border-radius:var(--radius-sm);cursor:pointer;font-size:0.75rem;font-weight:600;font-family:inherit;transition:all 0.2s var(--ease-out)}
.btn-refresh:hover{background:rgba(255,255,255,0.1);color:var(--text-primary)}
.btn-refresh:active{transform:scale(0.97)}
.btn-refresh svg{width:14px;height:14px;transition:transform 0.5s var(--ease-out)}
.btn-refresh.spinning svg{animation:spin 0.6s linear}

/* ========== RESPONSIVE ========== */
@media(max-width:1200px){.stats-row{grid-template-columns:repeat(4,1fr)}.squadron-grid{grid-template-columns:repeat(3,1fr)}.skills-grid{grid-template-columns:1fr}.featured-grid{grid-template-columns:1fr}}
@media(max-width:1024px){.main-grid{grid-template-columns:1fr}.signals-grid{grid-template-columns:1fr}.sidebar{transform:translateX(-100%)}.sidebar.mobile-open{transform:translateX(0)}.main-content{margin-left:0 !important}.skills-top-row{flex-direction:column;align-items:stretch}.skills-search-wrap{max-width:none}.skills-sort{justify-content:center}}
@media(max-width:640px){.stats-row{grid-template-columns:repeat(2,1fr)}.page{padding:1rem}.topbar{padding:0 1rem}.squadron-grid{grid-template-columns:1fr 1fr}.flow-steps{flex-direction:column;gap:0.35rem}.flow-arrow{transform:rotate(90deg)}.signal-stats{grid-template-columns:repeat(2,1fr)}.cmd-trigger{display:none}.skills-stats-row{gap:0.5rem;font-size:0.65rem}.skills-sort{flex-wrap:wrap}}
@media(max-width:400px){.stats-row{grid-template-columns:1fr}}
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:0.01ms !important;transition-duration:0.01ms !important;animation-iteration-count:1 !important}}

/* ========== FINISHING TOUCHES - Phase 6 ========== */
::selection{background:rgba(139,92,246,0.25);color:#fff}
:focus-visible{outline:2px solid rgba(139,92,246,0.5);outline-offset:2px;border-radius:var(--radius-sm)}
/* Smooth page section transitions */
.page-section{animation:fade-in 0.3s var(--ease-out)}
/* Number styling */
[class*="stat-val"],[class*="score-num"],[class*="sub-count"]{font-variant-numeric:tabular-nums}
/* Interactive states - press feedback */
.nav-item:active,.tab-btn:active,.cat-pill:active,.sort-btn:active,.filter-btn:active{transform:scale(0.97)}
/* Subtle border glow on focused inputs */
.skills-search:focus,.cmd-input:focus{caret-color:var(--accent-purple)}
/* Reduced stagger on dynamic lists */
.list-item{transition:background 0.15s var(--ease-out)}
/* Animated gradient line at top of page */
.topbar::after{content:"";position:absolute;bottom:-1px;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(139,92,246,0.15) 30%,rgba(6,182,212,0.15) 70%,transparent);opacity:0.6}
</style>
</head>
<body>

<!-- Background layers -->
<div class="bg-layer">
  <div class="aurora-orb"></div>
  <div class="aurora-orb"></div>
  <div class="aurora-orb"></div>
  <div class="aurora-orb"></div>
</div>
<div class="dot-grid"></div>
<div class="noise-overlay"></div>

<div class="app-layout">

<!-- ========== SIDEBAR ========== -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">&#x1f9de;</div>
    <div class="sidebar-brand">
      <h2>MVP Factory</h2>
      <span>Command Center</span>
    </div>
  </div>

  <nav class="sidebar-nav">
    <div class="nav-section">
      <div class="nav-label">Overview</div>
      <div class="nav-item active" data-page="dashboard" onclick="navigateTo('dashboard')">
        <span class="nav-icon">&#9881;&#65039;</span>
        <span class="nav-text">Dashboard</span>
      </div>
      <div class="nav-item" data-page="pipeline" onclick="navigateTo('pipeline')">
        <span class="nav-icon">&#128203;</span>
        <span class="nav-text">Pipeline</span>
        <span class="nav-badge" id="navQueueCount">0</span>
      </div>
      <div class="nav-item" data-page="signals" onclick="navigateTo('signals')">
        <span class="nav-icon">&#128225;</span>
        <span class="nav-text">Live Signals</span>
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">Squadron</div>
      <div class="nav-item" data-page="agents" onclick="navigateTo('agents')">
        <span class="nav-icon">&#129302;</span>
        <span class="nav-text">Agents</span>
        <span class="nav-badge">5</span>
      </div>
      <div class="nav-item" data-page="skills" onclick="navigateTo('skills')">
        <span class="nav-icon">&#9889;</span>
        <span class="nav-text">ClawHub Skills</span>
        <span class="nav-badge" id="navSkillCount">34</span>
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">System</div>
      <div class="nav-item" data-page="logs" onclick="navigateTo('logs')">
        <span class="nav-icon">&#128421;</span>
        <span class="nav-text">Logs</span>
      </div>
      <div class="nav-item" data-page="architecture" onclick="navigateTo('architecture')">
        <span class="nav-icon">&#127963;&#65039;</span>
        <span class="nav-text">Architecture</span>
      </div>
    </div>
  </nav>

  <div class="sidebar-footer">
    <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle sidebar">&#9776;</button>
    <span class="sidebar-version">NeuraFinity v2026.2.3</span>
  </div>
</aside>

<!-- ========== MAIN CONTENT ========== -->
<div class="main-content">

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="topbar-left">
      <button class="topbar-btn" onclick="toggleSidebar()" style="display:none" id="mobileMenuBtn">&#9776;</button>
      <div class="breadcrumb">
        <span>MVP Factory</span>
        <span style="opacity:0.3">/</span>
        <span class="breadcrumb-active" id="breadcrumbPage">Dashboard</span>
      </div>
      <div class="cmd-trigger" onclick="openCommandPalette()">
        <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
        Search commands...
        <kbd>Ctrl+K</kbd>
      </div>
    </div>
    <div class="topbar-right">
      <div class="status-pill">
        <span class="status-dot green" id="sDot"></span>
        <span id="sText">Connecting...</span>
      </div>
      <span class="sys-badge" id="sysMem" title="Daemon memory"></span>
      <span class="sys-badge" id="sysLoad" title="System load"></span>
      <span class="live-dot" id="liveDot" title="SSE stream status"></span><span class="meta-time" id="lastUpdate"></span>
      <button class="topbar-btn" onclick="doRefresh()" id="refreshBtn" title="Refresh">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>
      </button>
      <button class="topbar-btn" onclick="toast('Notifications coming soon')" title="Notifications">
        &#128276;
        <span class="notif-dot"></span>
      </button>
    </div>
  </div>

  <div class="page">

    <!-- ===== DASHBOARD PAGE ===== -->
    <div class="page-section active" id="page-dashboard">

      <!-- SQUADRON AGENTS -->
      <div class="squadron-grid ani d1" id="squadronGrid"></div>

      <!-- STATS ROW -->
      <div class="stats-row">
        <div class="card stat-card ani d1">
          <div class="stat-icon">&#127942;</div>
          <div class="stat-value" id="vTotal">--</div>
          <div class="stat-label">Total Shipped</div>
          <div class="stat-sub" id="subTotal">unique products</div>
        </div>
        <div class="card stat-card ani d2">
          <div class="stat-icon">&#127760;</div>
          <div class="stat-value" id="vWeb">--</div>
          <div class="stat-label">Web Apps</div>
          <div class="stat-sub" id="subWeb">Next.js projects</div>
        </div>
        <div class="card stat-card ani d3">
          <div class="stat-icon">&#9729;&#65039;</div>
          <div class="stat-value" id="vSaas">--</div>
          <div class="stat-label">SaaS Products</div>
          <div class="stat-sub">cloud platforms</div>
        </div>
        <div class="card stat-card ani d4">
          <div class="stat-icon">&#128241;</div>
          <div class="stat-value" id="vMobile">--</div>
          <div class="stat-label">Mobile Apps</div>
          <div class="stat-sub" id="subMobile">Expo projects</div>
        </div>
        <div class="card stat-card ani d5">
          <div class="stat-icon">&#128268;</div>
          <div class="stat-value" id="vExtension">--</div>
          <div class="stat-label">Extensions</div>
          <div class="stat-sub">browser plugins</div>
        </div>
        <div class="card stat-card ani d5">
          <div class="stat-icon">&#128279;</div>
          <div class="stat-value" id="vApi">--</div>
          <div class="stat-label">API Services</div>
          <div class="stat-sub">REST endpoints</div>
        </div>
        <div class="card stat-card ani d5">
          <div class="stat-icon">&#9889;</div>
          <div class="stat-value" id="vLive">--</div>
          <div class="stat-label">Live on Vercel</div>
          <div class="stat-sub" id="subLive">deployed</div>
        </div>
        <div class="card stat-card ani d5">
          <div class="stat-icon">&#128203;</div>
          <div class="stat-value" id="vQueue">--</div>
          <div class="stat-label">In Queue</div>
          <div class="stat-sub">ideas waiting</div>
        </div>
      </div>
      <!-- MONETIZATION ROW -->
      <div class="stats-row" style="grid-template-columns:repeat(4,1fr);margin-top:0;margin-bottom:1.25rem">
        <div class="card stat-card ani d2" style="padding:0.9rem 0.75rem 0.75rem">
          <div class="stat-icon" style="width:32px;height:32px;font-size:0.9rem;background:rgba(16,185,129,0.12)">&#128178;</div>
          <div class="stat-value" id="vFreeAds" style="font-size:1.6rem;color:#6ee7b7">--</div>
          <div class="stat-label">Free + Ads</div>
          <div class="stat-sub">ilovepdf-style</div>
        </div>
        <div class="card stat-card ani d3" style="padding:0.9rem 0.75rem 0.75rem">
          <div class="stat-icon" style="width:32px;height:32px;font-size:0.9rem;background:rgba(59,130,246,0.12)">&#128640;</div>
          <div class="stat-value" id="vFreemium" style="font-size:1.6rem;color:#93c5fd">--</div>
          <div class="stat-label">Freemium</div>
          <div class="stat-sub">free tier + upgrade</div>
        </div>
        <div class="card stat-card ani d4" style="padding:0.9rem 0.75rem 0.75rem">
          <div class="stat-icon" style="width:32px;height:32px;font-size:0.9rem;background:rgba(139,92,246,0.12)">&#128184;</div>
          <div class="stat-value" id="vSaasM" style="font-size:1.6rem;color:#c4b5fd">--</div>
          <div class="stat-label">SaaS Paid</div>
          <div class="stat-sub">subscription</div>
        </div>
        <div class="card stat-card ani d5" style="padding:0.9rem 0.75rem 0.75rem">
          <div class="stat-icon" style="width:32px;height:32px;font-size:0.9rem;background:rgba(245,158,11,0.12)">&#127381;</div>
          <div class="stat-value" id="vOneTime" style="font-size:1.6rem;color:#fcd34d">--</div>
          <div class="stat-label">One-Time</div>
          <div class="stat-sub">single purchase</div>
        </div>
      </div>

      <!-- CURRENT BUILD -->
      <div class="current-build-card ani d5" id="currentCard">
        <div class="current-build-inner">
          <div class="card-header">
            <div class="card-title"><span>&#128296;</span> Currently Building</div>
            <span class="card-count" id="buildPhase">idle</span>
          </div>
          <div id="currentContent">
            <div class="build-idle">
              <div class="idle-icon">&#128564;</div>
              <div class="idle-text">Idle &mdash; waiting for next build cycle</div>
              <div class="idle-sub">The daemon checks the queue every 30 minutes</div>
            </div>
          </div>
        </div>
      </div>

      <!-- MAIN GRID: LOGS + PIPELINE -->
      <div class="main-grid">
        <div class="card terminal ani d6" style="padding:0">
          <div class="terminal-header">
            <div class="terminal-dots"><span></span><span></span><span></span></div>
            <div class="terminal-title">daemon.log &mdash; live feed</div>
            <span class="terminal-badge" id="logBadge">live</span>
          </div>
          <div class="log-filter-bar">
            <button class="log-filter-btn active" data-agent="all" onclick="setLogFilter('all')">All</button>
            <button class="log-filter-btn" data-agent="RA" onclick="setLogFilter('RA')">RA</button>
            <button class="log-filter-btn" data-agent="VA" onclick="setLogFilter('VA')">VA</button>
            <button class="log-filter-btn" data-agent="FA" onclick="setLogFilter('FA')">FA</button>
            <button class="log-filter-btn" data-agent="BA" onclick="setLogFilter('BA')">BA</button>
            <button class="log-filter-btn" data-agent="PM" onclick="setLogFilter('PM')">PM</button>
          </div>
          <div class="log-viewer" id="logViewer"></div>
        </div>
        <div class="sidebar-stack">
          <div class="card ani d7">
            <div class="card-header">
              <div class="card-title"><span>&#128203;</span> Pipeline</div>
              <span class="card-count" id="pipeCount">0</span>
            </div>
            <div class="tabs" id="pipeTabs">
              <button class="tab-btn active" data-tab="queue" onclick="switchTab('queue')">Queue</button>
              <button class="tab-btn" data-tab="built" onclick="switchTab('built')">Shipped</button>
            </div>
            <div class="list-scroll" id="queueList"><div class="empty"><div class="empty-icon">&#128203;</div>Loading queue...</div></div>
            <div class="list-scroll" id="builtList" style="display:none"><div class="empty"><div class="empty-icon">&#127942;</div>Loading builds...</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== SKILLS PAGE ===== -->
    <div class="page-section" id="page-skills">
      <div class="skills-page-header ani">
        <div class="skills-top-row">
          <h3><span>&#9889;</span> ClawHub Skills Marketplace</h3>
          <div class="skills-search-wrap">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input class="skills-search" id="skillsSearch" placeholder="Search 5,705+ skills..." autocomplete="off" spellcheck="false" oninput="onSkillSearch(this.value)">
          </div>
          <div class="skills-sort">
            <button class="sort-btn active" data-sort="downloads" onclick="sortSkills('downloads')">&#11206; Downloads</button>
            <button class="sort-btn" data-sort="rating" onclick="sortSkills('rating')">&#11088; Rating</button>
            <button class="sort-btn" data-sort="name" onclick="sortSkills('name')">A-Z</button>
          </div>
        </div>
        <div class="skills-stats-row" id="skillsStatsRow">
          <div class="skills-stat"><strong id="skillsTotalCount">0</strong> skills</div>
          <div class="skills-stat"><strong id="skillsInstalledCount">0</strong> installed</div>
          <div class="skills-stat"><strong id="skillsVerifiedCount">0</strong> verified</div>
          <div class="skills-stat">&#9889; <strong id="skillsTotalDownloads">0</strong> total downloads</div>
        </div>
        <div class="skills-categories" id="skillsCategories"></div>
      </div>
      <div class="skills-featured" id="skillsFeatured">
        <div class="skills-featured-title">&#11088; Featured Skills</div>
        <div class="featured-grid" id="featuredGrid"></div>
      </div>
      <div class="skills-featured-title" style="margin-top:0.5rem">&#128230; All Skills</div>
      <div class="skills-grid ani d1" id="skillsGrid"></div>
    </div>

    <!-- ===== AGENTS PAGE ===== -->
    <div class="page-section" id="page-agents">
      <div class="skills-header ani">
        <h3><span>&#129302;</span> Squadron Agents</h3>
      </div>
      <div class="squadron-grid ani d1" id="agentsFullGrid"></div>
    </div>

    <!-- ===== SIGNALS PAGE ===== -->
    <div class="page-section" id="page-signals">
      <div class="signals-section ani">
        <div class="card flow-card">
          <div class="card-header">
            <div class="card-title"><span>&#128256;</span> Idea Pipeline Flow</div>
            <span class="card-count" id="flowSource">--</span>
          </div>
          <div class="flow-steps">
            <div class="flow-step active">&#128225; Reddit</div>
            <span class="flow-arrow">&#10132;</span>
            <div class="flow-step active">&#128293; Hacker News</div>
            <span class="flow-arrow">&#10132;</span>
            <div class="flow-step active">&#128187; Dev.to</div>
            <span class="flow-arrow">&#10132;</span>
            <div class="flow-step ai">&#129302; Kimi K2.5</div>
            <span class="flow-arrow">&#10132;</span>
            <div class="flow-step build">&#128296; Build MVP</div>
          </div>
          <div class="flow-sub">Reddit (55 subs) + Hacker News + Dev.to &#8594; engagement filter &#8594; AI extracts ideas &#8594; validation scoring &#8594; approved ideas queued &#8594; code, test, deploy</div>
        </div>
        <div class="signals-grid">
          <div class="card">
            <div class="card-header">
              <div class="live-feed-header">
                <div class="live-dot"></div>
                <span class="live-label">Live</span>
                <div class="card-title" style="margin:0"><span>&#128225;</span> Market Signals</div>
              </div>
              <span class="card-count" id="sigCount">0</span>
            </div>
            <div class="signal-stats" id="sigStats">
              <div class="signal-stat"><div class="signal-stat-val reddit" id="sigTotal">--</div><div class="signal-stat-lbl">Total</div></div>
              <div class="signal-stat"><div class="signal-stat-val kw" id="sigKw">--</div><div class="signal-stat-lbl">With Keywords</div></div>
              <div class="signal-stat"><div class="signal-stat-val sub" id="sigSubs">--</div><div class="signal-stat-lbl">Sources</div></div>
              <div class="signal-stat"><div class="signal-stat-val files" id="sigFiles">--</div><div class="signal-stat-lbl">Sessions</div></div>
            </div>
            <div class="source-tabs">
              <button class="source-tab src-all active" onclick="filterSignals('all')">All</button>
              <button class="source-tab src-reddit" onclick="filterSignals('reddit')">&#128225; Reddit <span id="srcCountReddit"></span></button>
              <button class="source-tab src-hackernews" onclick="filterSignals('hackernews')">&#128293; Hacker News <span id="srcCountHN"></span></button>
              <button class="source-tab src-devto" onclick="filterSignals('devto')">&#128187; Dev.to <span id="srcCountDevto"></span></button>
            </div>
            <div class="list-scroll" id="signalList" style="max-height:380px">
              <div class="empty"><div class="empty-icon">&#128225;</div>Loading signals...</div>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:1.25rem">
            <div class="card">
              <div class="card-header">
                <div class="card-title"><span>&#128202;</span> Signals by Source</div>
              </div>
              <div id="subChart" class="sub-chart">
                <div class="empty"><div class="empty-icon">&#128202;</div>Loading...</div>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <div class="card-title"><span>&#128161;</span> Data Sources</div>
              </div>
              <div style="font-size:0.7rem;color:var(--text-secondary);line-height:1.7">
                <div style="display:flex;flex-direction:column;gap:0.55rem">
                  <div><span style="color:#ff6200;font-weight:700">&#128225; Reddit</span> â€” 13 subreddits (SideProject, startups, SaaS&hellip;) via public JSON API</div>
                  <div><span style="color:#ff6600;font-weight:700">&#128293; Hacker News</span> â€” Top stories + Ask HN via Firebase API (no key needed)</div>
                  <div><span style="color:#60a5fa;font-weight:700">&#128187; Dev.to</span> â€” Trending articles by tag: showdev, buildinpublic, startup&hellip;</div>
                </div>
                <div style="margin-top:0.75rem;padding-top:0.75rem;border-top:1px solid rgba(255,255,255,0.06);display:flex;flex-direction:column;gap:0.3rem">
                  <div>&#9312; Multi-source scrape every 4 hours</div>
                  <div>&#9313; Filter by <span style="color:#fbbf24">signal keywords</span> + <span style="color:#ff6200">engagement score</span></div>
                  <div>&#9314; Combined top 30 fed to <span style="color:#a78bfa">Kimi K2.5</span> for MVP ideas</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== PIPELINE PAGE ===== -->
    <div class="page-section" id="page-pipeline">
      <div id="pipelineActivityBanner" style="display:none" class="pipeline-activity idle ani">
        <div class="pa-dot"></div>
        <div class="pa-text"><span class="pa-phase" id="paPhase">idle</span><span class="pa-detail" id="paDetail">No active cycle</span></div>
        <span class="pa-count" id="paCount"></span>
      </div>
      <div class="card ani">
        <div class="card-header">
          <div class="card-title"><span>&#128203;</span> Full Pipeline View</div>
          <span class="card-count" id="fullPipeCount">0</span>
        </div>
        <div class="tabs">
          <button class="tab-btn active" data-tab="fqueue" onclick="switchFullTab('fqueue')">Queue</button>
          <button class="tab-btn" data-tab="fbuilt" onclick="switchFullTab('fbuilt')">Shipped</button>
        </div>
        <div class="list-scroll" id="fullQueueList" style="max-height:600px"><div class="empty"><div class="empty-icon">&#128203;</div>Loading...</div></div>
        <div class="list-scroll" id="fullBuiltList" style="display:none;max-height:600px"><div class="empty"><div class="empty-icon">&#127942;</div>Loading...</div></div>
      </div>
    </div>

    <!-- ===== LOGS PAGE ===== -->
    <div class="page-section" id="page-logs">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;height:calc(100vh - 140px)">

        <!-- Panel 1: Research & Validation -->
        <div class="card terminal ani" style="padding:0;display:flex;flex-direction:column;min-height:0">
          <div class="terminal-header">
            <div class="terminal-dots"><span></span><span></span><span></span></div>
            <div class="terminal-title">&#128225; Research &amp; Validation</div>
            <span class="terminal-badge">live</span>
          </div>
          <div class="log-filter-bar" style="flex-shrink:0">
            <button class="log-filter-btn active" data-panel="rv" data-agent="all"  onclick="setLogFilterPanel('rv','all')">All</button>
            <button class="log-filter-btn"         data-panel="rv" data-agent="RA"   onclick="setLogFilterPanel('rv','RA')">Research</button>
            <button class="log-filter-btn"         data-panel="rv" data-agent="VA"   onclick="setLogFilterPanel('rv','VA')">Validation</button>
          </div>
          <div class="log-viewer" id="logPanelRV" style="flex:1;min-height:0;overflow-y:auto"></div>
        </div>

        <!-- Panel 2: Build (Frontend / Backend / PM) -->
        <div class="card terminal ani" style="padding:0;display:flex;flex-direction:column;min-height:0">
          <div class="terminal-header">
            <div class="terminal-dots"><span></span><span></span><span></span></div>
            <div class="terminal-title">&#128296; Build &mdash; Frontend / Backend / PM</div>
            <span class="terminal-badge">live</span>
          </div>
          <div class="log-filter-bar" style="flex-shrink:0">
            <button class="log-filter-btn active" data-panel="bp" data-agent="all"  onclick="setLogFilterPanel('bp','all')">All</button>
            <button class="log-filter-btn"         data-panel="bp" data-agent="FA"   onclick="setLogFilterPanel('bp','FA')">Frontend</button>
            <button class="log-filter-btn"         data-panel="bp" data-agent="BA"   onclick="setLogFilterPanel('bp','BA')">Backend</button>
            <button class="log-filter-btn"         data-panel="bp" data-agent="PM"   onclick="setLogFilterPanel('bp','PM')">PM</button>
          </div>
          <div class="log-viewer" id="logPanelBP" style="flex:1;min-height:0;overflow-y:auto"></div>
        </div>

      </div>
      <!-- Single full log (hidden â€” still used by sidebar log widget) -->
      <div id="fullLogViewer" style="display:none"></div>
    </div>

    <!-- ===== ARCHITECTURE PAGE ===== -->
    <div class="page-section" id="page-architecture">
      <div class="arch-header ani">
        <h2>&#127963;&#65039; System Architecture</h2>
        <p>Live diagram of the MVP Factory pipeline &mdash; highlights active stages in real-time as the system runs.</p>
        <div class="arch-live-bar" id="archLiveBar"><span style="opacity:0.4">Connecting...</span></div>
      </div>

      <div class="arch-pipeline ani d2">

        <!-- Data Sources -->
        <div class="arch-node" id="archNodeSources">
          <div class="arch-node-icon">&#128225;</div>
          <div class="arch-node-body">
            <div class="arch-node-title">Data Sources</div>
            <div class="arch-node-desc">Multi-platform signal collection &mdash; scans for startup ideas, pain points, and market gaps</div>
            <div class="arch-node-tags">
              <span class="arch-tag arch-tag-orange">Reddit (55 subs)</span>
              <span class="arch-tag arch-tag-orange">Hacker News</span>
              <span class="arch-tag arch-tag-blue">Dev.to</span>
            </div>
          </div>
          <div class="arch-node-stat" id="archStatSources">&mdash;</div>
          <div class="arch-node-status" id="archStatusSources"></div>
        </div>

        <div class="arch-arrow"></div>

        <!-- ResearchAgent -->
        <div class="arch-node" id="archNodeRA">
          <div class="arch-node-icon">&#128300;</div>
          <div class="arch-node-body">
            <div class="arch-node-title">ResearchAgent</div>
            <div class="arch-node-desc">Fetches posts, extracts keywords &amp; engagement signals, filters by score threshold</div>
            <div class="arch-node-tags">
              <span class="arch-tag arch-tag-amber">MAX_SUBS = 30</span>
              <span class="arch-tag arch-tag-amber">MAX_PER_SUB = 8</span>
              <span class="arch-tag arch-tag-amber">MAX_TOTAL = 200</span>
            </div>
          </div>
          <div class="arch-node-stat" id="archStatRA">&mdash;</div>
          <div class="arch-node-status" id="archStatusRA"></div>
        </div>

        <div class="arch-arrow"></div>

        <!-- ValidationAgent -->
        <div class="arch-node" id="archNodeVA">
          <div class="arch-node-icon">&#9989;</div>
          <div class="arch-node-body">
            <div class="arch-node-title">ValidationAgent</div>
            <div class="arch-node-desc">LLM scores each idea on 3 dimensions; approved ideas enter the build queue</div>
            <div class="arch-node-tags">
              <span class="arch-tag arch-tag-red">Kimi K2.5 (NVIDIA)</span>
              <span class="arch-tag arch-tag-red">Market Demand</span>
              <span class="arch-tag arch-tag-red">Competition Gap</span>
              <span class="arch-tag arch-tag-red">Tech Feasibility</span>
              <span class="arch-tag arch-tag-red">Min score: 6/10</span>
            </div>
          </div>
          <div class="arch-node-stat" id="archStatVA">&mdash;</div>
          <div class="arch-node-status" id="archStatusVA"></div>
        </div>

        <div class="arch-arrow"></div>

        <!-- Parallel Build -->
        <div class="arch-parallel-row">
          <div class="arch-node arch-node-build" id="archNodeFA">
            <div class="arch-node-icon">&#127912;</div>
            <div class="arch-node-body">
              <div class="arch-node-title">FrontendAgent</div>
              <div class="arch-node-desc">React + Tailwind + Framer Motion + Lucide, Zod validation, full UI components</div>
            </div>
            <div class="arch-node-status" id="archStatusFA"></div>
          </div>
          <div class="arch-parallel-sep">
            <div class="arch-parallel-line"></div>
            <span>&#9568;&#9572;</span>
            <div class="arch-parallel-line"></div>
          </div>
          <div class="arch-node arch-node-build" id="archNodeBA">
            <div class="arch-node-icon">&#9881;&#65039;</div>
            <div class="arch-node-body">
              <div class="arch-node-title">BackendAgent</div>
              <div class="arch-node-desc">Express.js REST APIs, database integration, authentication, server-side logic</div>
            </div>
            <div class="arch-node-status" id="archStatusBA"></div>
          </div>
        </div>

        <div class="arch-arrow"></div>

        <!-- PMAgent -->
        <div class="arch-node" id="archNodePM">
          <div class="arch-node-icon">&#129514;</div>
          <div class="arch-node-body">
            <div class="arch-node-title">PMAgent &mdash; Quality Gate</div>
            <div class="arch-node-desc">Reviews code quality, tests functionality, scores the build. Rejects if below threshold.</div>
            <div class="arch-node-tags">
              <span class="arch-tag arch-tag-purple">Code Quality Review</span>
              <span class="arch-tag arch-tag-purple">Min score: 5/8</span>
              <span class="arch-tag arch-tag-purple">Auto-retry on fail</span>
            </div>
          </div>
          <div class="arch-node-status" id="archStatusPM"></div>
        </div>

        <div class="arch-arrow"></div>

        <!-- Deploy -->
        <div class="arch-node" id="archNodeDeploy">
          <div class="arch-node-icon">&#128640;</div>
          <div class="arch-node-body">
            <div class="arch-node-title">Deploy</div>
            <div class="arch-node-desc">Commits to GitHub, triggers Vercel deployment, generates live URL &mdash; product shipped!</div>
            <div class="arch-node-tags">
              <span class="arch-tag arch-tag-green">GitHub</span>
              <span class="arch-tag arch-tag-green">Vercel</span>
              <span class="arch-tag arch-tag-green">Live URL</span>
            </div>
          </div>
          <div class="arch-node-stat" id="archStatDeploy">&mdash;</div>
          <div class="arch-node-status" id="archStatusDeploy"></div>
        </div>

      </div><!-- end arch-pipeline -->

      <!-- Tech Stack + Cycle info -->
      <div class="arch-tech-row ani d4">
        <div class="card" style="padding:1.25rem">
          <div class="card-header"><div class="card-title">&#128736; Tech Stack</div></div>
          <div class="arch-tech-grid">
            <div class="arch-tech-item"><span class="arch-tech-name">LLM</span><span class="arch-tech-val">Kimi K2.5 via NVIDIA API</span></div>
            <div class="arch-tech-item"><span class="arch-tech-name">Runtime</span><span class="arch-tech-val">Node.js + TypeScript</span></div>
            <div class="arch-tech-item"><span class="arch-tech-name">Frontend Gen</span><span class="arch-tech-val">React + Tailwind + Framer Motion</span></div>
            <div class="arch-tech-item"><span class="arch-tech-name">Backend Gen</span><span class="arch-tech-val">Express.js + REST APIs</span></div>
            <div class="arch-tech-item"><span class="arch-tech-name">Signals</span><span class="arch-tech-val">Reddit (55 subs) + HN + Dev.to</span></div>
            <div class="arch-tech-item"><span class="arch-tech-name">Deploy</span><span class="arch-tech-val">GitHub + Vercel</span></div>
            <div class="arch-tech-item"><span class="arch-tech-name">Dashboard</span><span class="arch-tech-val">Vanilla JS + SSE (real-time)</span></div>
            <div class="arch-tech-item"><span class="arch-tech-name">Wallets</span><span class="arch-tech-val">Base Chain &mdash; 4 agents</span></div>
          </div>
        </div>
        <div class="card" style="padding:1.25rem">
          <div class="card-header"><div class="card-title">&#9654;&#65039; Cycle Flow</div></div>
          <div style="display:flex;flex-direction:column;gap:0">
            <div class="arch-cycle-step"><span class="arch-cycle-num">1</span>Research cycle triggers every <strong>15 min</strong></div>
            <div class="arch-cycle-step"><span class="arch-cycle-num">2</span>Scrapes up to <strong>200 posts</strong> across 55 subreddits + HN + Dev.to</div>
            <div class="arch-cycle-step"><span class="arch-cycle-num">3</span>LLM validates each idea &mdash; approved ideas enter build queue</div>
            <div class="arch-cycle-step"><span class="arch-cycle-num">4</span>Build cycle picks next idea from the validated queue</div>
            <div class="arch-cycle-step"><span class="arch-cycle-num">5</span>FrontendAgent + BackendAgent build in <strong>parallel</strong></div>
            <div class="arch-cycle-step"><span class="arch-cycle-num">6</span>PMAgent reviews quality &mdash; min score <strong>5/8</strong> to pass</div>
            <div class="arch-cycle-step"><span class="arch-cycle-num">7</span>Ships to <strong>GitHub + Vercel</strong> automatically &mdash; product live!</div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer ani d8">
      MVP Factory Command Center &bull; Live via SSE &bull; Powered by MVP Factory (NeuraFinity)
    </div>
  </div>
</div>
</div>

<!-- COMMAND PALETTE -->
<div class="cmd-overlay" id="cmdOverlay" onclick="if(event.target===this)closeCommandPalette()">
  <div class="cmd-modal">
    <div class="cmd-input-wrap">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
      <input class="cmd-input" id="cmdInput" placeholder="Type a command or search..." autocomplete="off" spellcheck="false">
    </div>
    <div class="cmd-results" id="cmdResults"></div>
    <div class="cmd-footer">
      <span><kbd>&#8593;&#8595;</kbd> navigate</span>
      <span><kbd>&#9166;</kbd> select</span>
      <span><kbd>Esc</kbd> close</span>
    </div>
  </div>
</div>

<!-- Toast container -->
<div class="toast-container" id="toasts"></div>

<script>
/* ========== UTILITIES ========== */
function relTime(iso){if(!iso)return"";const d=Date.now()-new Date(iso).getTime();const m=Math.floor(d/60000);if(m<1)return"just now";if(m<60)return m+"m ago";const h=Math.floor(m/60);if(h<24)return h+"h ago";return Math.floor(h/24)+"d ago"}
function esc(s){return String(s).replace(/</g,"&lt;").replace(/>/g,"&gt;")}
function badgeCls(t){return({web:"badge-web",saas:"badge-saas",mobile:"badge-mobile",extension:"badge-extension",api:"badge-api"})[t]||"badge-web"}
function badgeLbl(t){return({web:"Web",saas:"SaaS",mobile:"Mobile",extension:"Ext",api:"API"})[t]||t||"Web"}
function monetizeBadge(m){const map={free_ads:["#10b981","Ads"],freemium:["#3b82f6","Free+"],saas:["#8b5cf6","Paid"],one_time:["#f59e0b","Once"]};const r=map[m];if(!r)return"";return'<span style="font-size:0.5rem;padding:0.1rem 0.35rem;border-radius:3px;background:'+r[0]+'18;color:'+r[0]+';border:1px solid '+r[0]+'44;font-weight:700">'+r[1]+'</span>'}
function scoreCls(pct){return pct>=75?"score-high":pct>=50?"score-mid":"score-low"}
function detectAgent(l){if(l.includes("[ResearchAgent]"))return"RA";if(l.includes("[ValidationAgent]"))return"VA";if(l.includes("[FrontendAgent]"))return"FA";if(l.includes("[BackendAgent]"))return"BA";if(l.includes("[PMAgent]"))return"PM";return null}
const agentMeta={RA:{cls:"log-research",label:"RA",bg:"rgba(245,158,11,0.15)",color:"#f59e0b"},VA:{cls:"log-validation",label:"VA",bg:"rgba(239,68,68,0.15)",color:"#ef4444"},FA:{cls:"log-frontend",label:"FA",bg:"rgba(59,130,246,0.15)",color:"#3b82f6"},BA:{cls:"log-backend",label:"BA",bg:"rgba(16,185,129,0.15)",color:"#10b981"},PM:{cls:"log-pm",label:"PM",bg:"rgba(139,92,246,0.15)",color:"#8b5cf6"}};
function logCls(l){const agent=detectAgent(l);if(agent)return agentMeta[agent].cls;if(l.includes("[ERROR]"))return"log-error";if(l.includes("[WARN]"))return"log-warn";if(l.includes("COMPLETE")||l.includes("SUCCESS")||l.includes("Deployed"))return"log-success";if(l.includes("Reddit")||l.includes("reddit")||l.includes("r/")||l.includes("signals"))return"log-reddit";if(l.includes("Building:")||l.includes("BUILD CYCLE")||l.includes("RESEARCH CYCLE"))return"log-build";if(l.includes("deploy")||l.includes("Vercel")||l.includes("GitHub"))return"log-deploy";return"log-info"}
function fmtLogLine(l){
  /* Note: all dynamic text passes through esc() which HTML-encodes < and > to prevent XSS */
  const isSep=l.includes("==========");if(isSep)return'<div class="log-line log-phase-separator">'+esc(l)+'</div>';const agent=detectAgent(l);const tsMatch=l.match(/^\[([^\]]+)\]/);const ts=tsMatch?tsMatch[1]:"";let badge="";if(agent){const m=agentMeta[agent];badge='<span class="log-agent-badge" style="background:'+m.bg+';color:'+m.color+'">'+m.label+'</span>'}const tsSpan=ts?'<span class="log-timestamp">'+esc(ts)+'</span>':'';return'<div class="log-line '+logCls(l)+'">'+tsSpan+badge+esc(l.replace(/^\[[^\]]+\]\s*(\[AGENT\]\s*)?/,""))+'</div>'}
let activeLogFilter="all";
let rawLogs=[];
function setLogFilter(f){activeLogFilter=f;document.querySelectorAll(".log-filter-btn").forEach(b=>b.classList.toggle("active",b.dataset.agent===f));renderFilteredLogs("logViewer");renderFilteredLogs("fullLogViewer")}

/* ========== SPLIT LOG PANELS ========== */
const logPanelFilters={rv:"all",bp:"all"};
// Agents shown in each panel (all = all agents for that panel only)
const panelAgentNames={rv:["ResearchAgent","ValidationAgent"],bp:["FrontendAgent","BackendAgent","PMAgent"]};
const panelAgentKeys={rv:{RA:"ResearchAgent",VA:"ValidationAgent"},bp:{FA:"FrontendAgent",BA:"BackendAgent",PM:"PMAgent"}};
function setLogFilterPanel(panel,agent){
  logPanelFilters[panel]=agent;
  document.querySelectorAll('[data-panel="'+panel+'"].log-filter-btn').forEach(b=>b.classList.toggle("active",b.dataset.agent===agent));
  renderLogPanel(panel);
}
function renderLogPanel(panel){
  const id={rv:"logPanelRV",bp:"logPanelBP"}[panel];
  const el=document.getElementById(id);if(!el)return;
  const wasAtBottom=el.scrollHeight-el.scrollTop-el.clientHeight<80;
  const agentKey=logPanelFilters[panel]||"all";
  let filtered;
  if(agentKey==="all"){
    // Show only logs belonging to this panel's agents
    const names=panelAgentNames[panel]||[];
    filtered=rawLogs.filter(l=>names.some(n=>l.includes("["+n+"]")));
  }else{
    const name=panelAgentKeys[panel][agentKey]||"";
    filtered=rawLogs.filter(l=>l.includes("["+name+"]"));
  }
  el.innerHTML=filtered.map(l=>fmtLogLine(l)).join("");
  if(wasAtBottom||firstLoad)el.scrollTop=el.scrollHeight;
}
function renderAllLogPanels(){renderLogPanel("rv");renderLogPanel("bp");}
function renderFilteredLogs(viewerId){const viewer=document.getElementById(viewerId);if(!viewer)return;const wasAtBottom=viewer.scrollHeight-viewer.scrollTop-viewer.clientHeight<60;let filtered=rawLogs;if(activeLogFilter!=="all"){const nameMap={RA:"ResearchAgent",VA:"ValidationAgent",FA:"FrontendAgent",BA:"BackendAgent",PM:"PMAgent"};const name=nameMap[activeLogFilter]||"";filtered=rawLogs.filter(l=>l.includes("["+name+"]"))}viewer.innerHTML=filtered.map(l=>fmtLogLine(l)).join("");if(wasAtBottom||firstLoad)viewer.scrollTop=viewer.scrollHeight}
function fmtNum(n){if(n>=1000)return(n/1000).toFixed(1)+"k";return String(n)}

/* ========== SPOTLIGHT EFFECT ========== */
document.addEventListener("mousemove",e=>{document.querySelectorAll(".card").forEach(c=>{const r=c.getBoundingClientRect();c.style.setProperty("--mouse-x",(e.clientX-r.left)+"px");c.style.setProperty("--mouse-y",(e.clientY-r.top)+"px")})});

/* ========== ANIMATED COUNTER ========== */
const prevVals={};
function animateNum(el,from,to,duration=700){
  if(from===to)return;
  const start=performance.now();
  const diff=to-from;
  const step=now=>{
    const t=Math.min((now-start)/duration,1);
    const ease=1-Math.pow(1-t,3);
    el.textContent=Math.round(from+diff*ease);
    if(t<1)requestAnimationFrame(step);
    else el.textContent=to;
  };
  requestAnimationFrame(step);
}
function setVal(id,val){
  const el=document.getElementById(id);if(!el)return;
  const s=String(val);
  if(prevVals[id]===s)return;
  const oldNum=parseInt(prevVals[id]);
  const newNum=parseInt(s);
  if(!isNaN(oldNum)&&!isNaN(newNum)&&oldNum!==newNum&&prevVals[id]!==undefined){
    animateNum(el,oldNum,newNum);
  }else{
    el.textContent=s;
  }
  el.classList.remove("count-changed");void el.offsetWidth;el.classList.add("count-changed");
  // Flash the parent card too
  const card=el.closest(".stat-card,.card");
  if(card){card.classList.remove("card-updated");void card.offsetWidth;card.classList.add("card-updated")}
  prevVals[id]=s;
}

/* ========== NAVIGATION ========== */
let currentPage="dashboard";
function navigateTo(page){
  currentPage=page;
  document.querySelectorAll(".page-section").forEach(s=>s.classList.remove("active"));
  const target=document.getElementById("page-"+page);
  if(target)target.classList.add("active");
  document.querySelectorAll(".nav-item").forEach(n=>n.classList.toggle("active",n.dataset.page===page));
  document.getElementById("breadcrumbPage").textContent=page.charAt(0).toUpperCase()+page.slice(1);
  if(page==="skills")renderSkills();
  if(page==="agents")renderAgentsPage();
  // Close mobile sidebar
  document.getElementById("sidebar").classList.remove("mobile-open");
}

/* ========== SIDEBAR ========== */
function toggleSidebar(){document.getElementById("sidebar").classList.toggle("collapsed")}

/* ========== TABS ========== */
let activeTab="queue";
function switchTab(tab){activeTab=tab;document.querySelectorAll("#pipeTabs .tab-btn").forEach(b=>b.classList.toggle("active",b.dataset.tab===tab));document.getElementById("queueList").style.display=tab==="queue"?"block":"none";document.getElementById("builtList").style.display=tab==="built"?"block":"none"}
function switchFullTab(tab){document.querySelectorAll("#page-pipeline .tab-btn").forEach(b=>b.classList.toggle("active",b.dataset.tab===tab));document.getElementById("fullQueueList").style.display=tab==="fqueue"?"block":"none";document.getElementById("fullBuiltList").style.display=tab==="fbuilt"?"block":"none"}

/* ========== COMMAND PALETTE ========== */
const commands=[
  {icon:"&#9881;&#65039;",label:"Dashboard",hint:"Go to overview",action:()=>navigateTo("dashboard")},
  {icon:"&#128203;",label:"Pipeline",hint:"View build queue",action:()=>navigateTo("pipeline")},
  {icon:"&#128225;",label:"Live Signals",hint:"View multi-source signal data",action:()=>navigateTo("signals")},
  {icon:"&#129302;",label:"Squadron Agents",hint:"View agent status",action:()=>navigateTo("agents")},
  {icon:"&#9889;",label:"ClawHub Skills",hint:"Browse marketplace",action:()=>navigateTo("skills")},
  {icon:"&#128421;",label:"System Logs",hint:"View daemon logs",action:()=>navigateTo("logs")},
  {icon:"&#127963;&#65039;",label:"Architecture",hint:"View system flow diagram",action:()=>navigateTo("architecture")},
  {icon:"&#128260;",label:"Refresh Data",hint:"Reload all data",action:()=>{doRefresh();closeCommandPalette()}},
  {icon:"&#9776;",label:"Toggle Sidebar",hint:"Collapse/expand",action:()=>{toggleSidebar();closeCommandPalette()}},
];
let cmdIdx=0;
function openCommandPalette(){document.getElementById("cmdOverlay").classList.add("open");document.getElementById("cmdInput").value="";renderCommands("");document.getElementById("cmdInput").focus();cmdIdx=0}
function closeCommandPalette(){document.getElementById("cmdOverlay").classList.remove("open")}
function renderCommands(q){
  const filtered=q?commands.filter(c=>c.label.toLowerCase().includes(q.toLowerCase())):commands;
  document.getElementById("cmdResults").innerHTML=filtered.map((c,i)=>'<div class="cmd-item'+(i===cmdIdx?" selected":"")+'" onclick="commands['+commands.indexOf(c)+'].action();closeCommandPalette()" onmouseenter="cmdIdx='+i+';renderCommands(document.getElementById(\'cmdInput\').value)"><div class="cmd-item-icon">'+c.icon+'</div><div class="cmd-item-text">'+c.label+'</div><div class="cmd-item-hint">'+c.hint+'</div></div>').join("")
}
document.addEventListener("keydown",e=>{
  if((e.ctrlKey||e.metaKey)&&e.key==="k"){e.preventDefault();openCommandPalette();return}
  if(!document.getElementById("cmdOverlay").classList.contains("open"))return;
  if(e.key==="Escape"){closeCommandPalette();return}
  const q=document.getElementById("cmdInput").value;
  const filtered=q?commands.filter(c=>c.label.toLowerCase().includes(q.toLowerCase())):commands;
  if(e.key==="ArrowDown"){e.preventDefault();cmdIdx=Math.min(cmdIdx+1,filtered.length-1);renderCommands(q)}
  if(e.key==="ArrowUp"){e.preventDefault();cmdIdx=Math.max(cmdIdx-1,0);renderCommands(q)}
  if(e.key==="Enter"&&filtered[cmdIdx]){filtered[cmdIdx].action();closeCommandPalette()}
});
document.getElementById("cmdInput").addEventListener("input",e=>{cmdIdx=0;renderCommands(e.target.value)});

/* ========== TOAST ========== */
function toast(msg){const d=document.createElement("div");d.className="toast";d.textContent=msg;document.getElementById("toasts").appendChild(d);setTimeout(()=>d.remove(),3200)}

/* ========== SPARKLINES ========== */
function renderSparkline(id,values,color){
  const el=document.getElementById(id);if(!el)return;
  const max=Math.max(...values,1);
  el.innerHTML=values.map(v=>{const h=Math.max(3,Math.round((v/max)*24));return'<div class="sparkline-bar" style="height:'+h+'px;background:'+color+'"></div>'}).join("")
}
// Generate random sparkline data for demo
const sparkData=Array.from({length:12},()=>Math.floor(Math.random()*8)+1);
renderSparkline("spark1",sparkData,"rgba(139,92,246,0.4)");

/* ========== SKILLS ========== */
let skillsData=[];
let skillFilter="all";
let skillSort="downloads";
let skillSearch="";
const catColors={search:"#f59e0b",ai:"#8b5cf6",comms:"#10b981",browser:"#3b82f6",dev:"#f0f2f5",coding:"#d4a574",productivity:"#f43f5e",media:"#a78bfa",notes:"#34d399",business:"#635bff",devops:"#2496ed",cli:"#a3e635",social:"#e879f9",marketing:"#1d9bf0"};
async function loadSkills(){try{skillsData=await api("/api/skills")||[]}catch{skillsData=[]}}

function onSkillSearch(q){skillSearch=q.toLowerCase();renderSkills()}

function sortSkills(s){
  skillSort=s;
  document.querySelectorAll(".sort-btn").forEach(b=>b.classList.toggle("active",b.dataset.sort===s));
  renderSkills();
}

function filterSkillsCat(cat){
  skillFilter=cat;
  document.querySelectorAll(".cat-pill").forEach(b=>b.classList.toggle("active",b.dataset.cat===cat));
  renderSkills();
}

function renderStars(rating){
  const full=Math.floor(rating);const half=rating%1>=0.5?1:0;const empty=5-full-half;
  return '<span class="stars">'+"&#9733;".repeat(full)+(half?"&#9734;":"")+"&#9734;".repeat(empty)+'</span><span class="rating-num">'+rating.toFixed(1)+'</span>';
}

function renderSkillCard(s,i,isFeatured){
  const verifiedBadge=s.verified?'<span class="verified-badge">&#10003;</span>':'';
  const catColor=catColors[s.category]||"#8892a4";
  return '<div class="card skill-card'+(isFeatured?' featured-card':'')+'" style="animation:fade-in-up 0.4s var(--ease-out-expo) '+(i*0.035)+'s both" onclick="toast(\'Opening '+esc(s.name)+' details...\')">'+
    '<div class="skill-icon" style="background:'+s.color+'18;color:'+s.color+'">'+s.name.charAt(0)+verifiedBadge+'</div>'+
    '<div class="skill-info">'+
      '<div class="skill-name">'+esc(s.name)+' '+
        (s.installed?'<span class="skill-installed" style="cursor:pointer" title="Click to uninstall" onclick="event.stopPropagation();uninstallSkill(\''+esc(s.name)+'\')">&#10003; Installed</span>':'<button class="skill-install-btn" onclick="event.stopPropagation();installSkill(\''+esc(s.name)+'\')">&#43; Install</button>')+
      '</div>'+
      '<div class="skill-desc">'+esc(s.desc)+'</div>'+
      '<div class="skill-meta">'+
        '<span class="skill-downloads">&#11206; '+fmtNum(s.downloads)+'</span>'+
        '<span class="skill-rating">'+renderStars(s.rating||0)+'</span>'+
        '<span class="skill-cat-badge" style="background:'+catColor+'15;color:'+catColor+';border:1px solid '+catColor+'30">'+s.category+'</span>'+
        '<span class="skill-version">v'+esc(s.version||"1.0")+'</span>'+
        '<span class="skill-author">by '+esc(s.author||"unknown")+'</span>'+
      '</div>'+
    '</div>'+
  '</div>';
}

async function installSkill(name){
  toast('Installing '+name+'...');
  try {
    const res=await fetch('/api/skills/install',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})});
    const data=await res.json();
    if(data.success){
      toast(name+' installed successfully!');
      const s=skillsData.find(x=>x.name===name);
      if(s)s.installed=true;
      renderSkills();
    } else {
      toast(data.error||'Install failed');
    }
  } catch(e){ toast('Install error: '+e.message); }
}

async function uninstallSkill(name){
  toast('Uninstalling '+name+'...');
  try {
    const res=await fetch('/api/skills/uninstall',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})});
    const data=await res.json();
    if(data.success){
      toast(name+' uninstalled');
      const s=skillsData.find(x=>x.name===name);
      if(s)s.installed=false;
      renderSkills();
    } else {
      toast(data.error||'Uninstall failed');
    }
  } catch(e){ toast('Uninstall error: '+e.message); }
}

function renderSkills(){
  // Filter
  let filtered=skillsData;
  if(skillFilter==="installed")filtered=skillsData.filter(s=>s.installed);
  else if(skillFilter!=="all")filtered=skillsData.filter(s=>s.category===skillFilter);
  // Search
  if(skillSearch)filtered=filtered.filter(s=>s.name.toLowerCase().includes(skillSearch)||s.desc.toLowerCase().includes(skillSearch)||s.category.toLowerCase().includes(skillSearch)||(s.author||"").toLowerCase().includes(skillSearch));
  // Sort
  filtered=[...filtered].sort((a,b)=>{
    if(skillSort==="downloads")return(b.downloads||0)-(a.downloads||0);
    if(skillSort==="rating")return(b.rating||0)-(a.rating||0);
    return a.name.localeCompare(b.name);
  });

  // Stats
  document.getElementById("skillsTotalCount").textContent=skillsData.length;
  document.getElementById("skillsInstalledCount").textContent=skillsData.filter(s=>s.installed).length;
  document.getElementById("skillsVerifiedCount").textContent=skillsData.filter(s=>s.verified).length;
  const totalDl=skillsData.reduce((a,s)=>a+(s.downloads||0),0);
  document.getElementById("skillsTotalDownloads").textContent=fmtNum(totalDl);

  // Categories
  const cats={};skillsData.forEach(s=>{cats[s.category]=(cats[s.category]||0)+1});
  const catEl=document.getElementById("skillsCategories");
  catEl.innerHTML='<button class="cat-pill'+(skillFilter==="all"?" active":"")+'" data-cat="all" onclick="filterSkillsCat(\'all\')">All <span class="cat-count">'+skillsData.length+'</span></button>'+
    '<button class="cat-pill'+(skillFilter==="installed"?" active":"")+'" data-cat="installed" onclick="filterSkillsCat(\'installed\')">Installed <span class="cat-count">'+skillsData.filter(s=>s.installed).length+'</span></button>'+
    Object.entries(cats).sort((a,b)=>b[1]-a[1]).map(([cat,count])=>{
      const color=catColors[cat]||"#8892a4";
      return '<button class="cat-pill'+(skillFilter===cat?" active":"")+'" data-cat="'+cat+'" onclick="filterSkillsCat(\''+cat+'\')" style="'+(skillFilter===cat?"background:"+color+"15;color:"+color+";border-color:"+color+"30":"")+'">'+cat.charAt(0).toUpperCase()+cat.slice(1)+' <span class="cat-count">'+count+'</span></button>'
    }).join("");

  // Featured
  const featuredEl=document.getElementById("skillsFeatured");
  const featuredGrid=document.getElementById("featuredGrid");
  if(!skillSearch&&(skillFilter==="all"||skillFilter==="installed")){
    const featured=skillsData.filter(s=>s.featured);
    if(featured.length){
      featuredEl.style.display="block";
      featuredGrid.innerHTML=featured.map((s,i)=>renderSkillCard(s,i,true)).join("");
    }else featuredEl.style.display="none";
  }else featuredEl.style.display="none";

  // Main grid
  const el=document.getElementById("skillsGrid");
  if(!el)return;
  if(!filtered.length){el.innerHTML='<div class="empty" style="grid-column:1/-1"><div class="empty-icon">&#128269;</div>No skills found matching "'+esc(skillSearch||skillFilter)+'"</div>';return}
  el.innerHTML=filtered.map((s,i)=>renderSkillCard(s,i,false)).join("");
}

/* ========== AGENTS PAGE ========== */
let squadronData=[];
function renderSquadronCards(){
  const el=document.getElementById("squadronGrid");
  if(!el||!squadronData.length)return;
  /* All dynamic text goes through esc() to prevent XSS */
  el.innerHTML=squadronData.map((a,i)=>{
    const statusCls=a.status==="active"?"online":"idle";
    return'<div class="card agent-card ani d'+(i+1)+'"><div class="agent-avatar '+statusCls+'" style="background:'+a.color+'20;color:'+a.color+'">'+esc(a.avatar)+'</div><div class="agent-name">'+esc(a.name)+'</div><div class="agent-role">'+esc(a.role)+'</div></div>'
  }).join("")
}
function renderAgentsPage(){
  const el=document.getElementById("agentsFullGrid");
  if(!el)return;
  if(!squadronData.length){el.innerHTML='<div class="empty"><div class="empty-icon">&#129302;</div>Loading agents...</div>';return}
  /* All dynamic text goes through esc() to prevent XSS */
  el.innerHTML=squadronData.map((a,i)=>{
    const statusCls=a.status==="active"?"online":"idle";
    const skillsHtml=(a.skills||[]).map(s=>'<span style="font-size:0.58rem;padding:0.1rem 0.4rem;border-radius:4px;background:'+a.color+'12;color:'+a.color+';border:1px solid '+a.color+'25;font-weight:600">'+esc(s)+'</span>').join(" ");
    return'<div class="card" style="padding:1.5rem;animation:fade-in-up 0.4s var(--ease-out-expo) '+(i*0.08)+'s both"><div style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem"><div class="agent-avatar '+statusCls+'" style="background:'+a.color+'20;color:'+a.color+';margin:0">'+esc(a.avatar)+'</div><div><div class="agent-name">'+esc(a.name)+'</div><div class="agent-role">'+esc(a.role)+'</div></div></div><div style="font-size:0.72rem;color:var(--text-secondary);line-height:1.6;margin-bottom:0.75rem">'+esc(a.desc)+'</div>'+(a.lastAction?'<div style="font-size:0.65rem;color:var(--text-tertiary);margin-bottom:0.6rem;font-style:italic">Last: '+esc(a.lastAction)+'</div>':'')+'<div style="display:flex;flex-wrap:wrap;gap:0.3rem;margin-bottom:0.6rem">'+skillsHtml+'</div><div style="display:flex;align-items:center;justify-content:flex-end"><div class="status-pill" style="font-size:0.65rem"><span class="status-dot '+statusCls+'"></span>'+esc(a.status)+'</div></div></div>'
  }).join("")
}

/* ========== FETCH ========== */
async function api(path){try{const r=await fetch(path);return await r.json()}catch{return null}}

/* ========== MAIN REFRESH ========== */
let firstLoad=true;

window._activeSignalFilter="all";

function filterSignals(src){
  window._activeSignalFilter=src;
  document.querySelectorAll(".source-tab").forEach(t=>t.classList.remove("active"));
  const btn=document.querySelector(".source-tab.src-"+src);if(btn)btn.classList.add("active");
  renderSignalList(window._allSignals||[],src);
}

function renderSignalList(sigs,filter){
  const sigEl=document.getElementById("signalList");if(!sigEl)return;
  const filtered=filter==="all"?sigs:sigs.filter(s=>(s.source||"reddit")===filter);
  if(!filtered.length){
    const icons={reddit:"&#128225;",hackernews:"&#128293;",devto:"&#128187;",all:"&#128225;"};
    sigEl.innerHTML='<div class="empty"><div class="empty-icon">'+(icons[filter]||"&#128225;")+'</div>No signals yet<br><span style="font-size:0.7rem;opacity:0.6">Signals appear after the first research cycle completes</span></div>';
    return;
  }
  const srcColors={reddit:"#ff6200",hackernews:"#ff6600",devto:"#60a5fa"};
  const srcLabels={reddit:"Reddit",hackernews:"HN",devto:"Dev.to"};
  sigEl.innerHTML=filtered.slice(0,25).map((s,i)=>{
    const src=s.source||"reddit";
    const clr=srcColors[src]||"#ff6200";
    const lbl=srcLabels[src]||"Reddit";
    const eng=(s.score||0)+2*(s.numComments||0)+5*(s.keywords?s.keywords.length:0);
    const sub=src==="hackernews"?"HN":src==="devto"?(s.subreddit||"Dev.to"):"r/"+(s.subreddit||"?");
    return'<div class="signal-item signal-item-new" style="animation-delay:'+(i*0.025)+'s">'
      +'<div class="signal-header">'
      +'<span class="signal-sub-badge" style="background:'+clr+'18;color:'+clr+';border-color:'+clr+'33">'+esc(sub)+'</span>'
      +'<span style="font-size:0.5rem;font-weight:700;padding:0.05rem 0.25rem;border-radius:3px;background:'+clr+'15;color:'+clr+';border:1px solid '+clr+'25;flex-shrink:0">'+lbl+'</span>'
      +'<div class="signal-title"><a href="'+esc(s.url||"")+'" target="_blank" title="'+esc(s.postTitle||"")+'">'+esc(s.postTitle||"")+'</a></div>'
      +'</div>'
      +'<div class="signal-metrics">'
      +'<span class="signal-metric"><span class="up">&#9650; '+(s.score||0)+'</span></span>'
      +'<span class="signal-metric"><span class="comments">&#128172; '+(s.numComments||0)+'</span></span>'
      +'<span class="signal-metric">&#9889; '+eng+'</span>'
      +'</div>'
      +(s.postBody?'<div class="signal-body">'+esc(s.postBody.substring(0,200))+'</div>':'')
      +(s.keywords&&s.keywords.length?'<div class="signal-keywords">'+s.keywords.slice(0,6).map(k=>'<span class="signal-kw">'+esc(k)+'</span>').join("")+'</div>':'')
      +'</div>';
  }).join("")
}

function doRefresh(){
  const btn=document.getElementById("refreshBtn");
  btn.style.animation="spin 0.6s linear";
  refreshAll().then(()=>{setTimeout(()=>btn.style.animation="",600);toast("Data refreshed")});
}

// Mobile detection
if(window.innerWidth<=1024){document.getElementById("mobileMenuBtn").style.display="flex";document.getElementById("sidebar").classList.add("collapsed")}

/* ========== SSE REAL-TIME STREAM ========== */
let sseActive=false;
let sseRetryCount=0;
const MAX_SSE_RETRIES=8;

function applySSEEvent(type,data){
  try{
    switch(type){
      case"status":
        if(data){const dot=document.getElementById("sDot"),txt=document.getElementById("sText");const cls=data.status==="active"?"green":data.status==="activating"?"amber":"red";dot.className="status-dot "+cls;txt.textContent=data.status==="active"?"Running":data.status;const m=document.getElementById("sysMem");if(m){m.textContent=data.memory||"";m.style.display=data.memory?"inline":"none"}}
        break;
      case"stats":
        if(data){
          setVal("vTotal",data.totalBuilt||0);setVal("vWeb",data.webCount||0);setVal("vSaas",data.saasCount||0);
          setVal("vMobile",data.mobileCount||0);setVal("vExtension",data.extensionCount||0);setVal("vApi",data.apiCount||0);
          setVal("vLive",data.liveCount||0);
          setVal("vFreeAds",data.freeAdsCount||0);setVal("vFreemium",data.freemiumCount||0);
          setVal("vSaasM",data.saasMonetizeCount||0);setVal("vOneTime",data.oneTimeCount||0);
          const st=document.getElementById("subTotal");
          window._githubUsername=data.githubUsername||"malikmuhammadsaadshafiq-dev";
          const ghRaw=data.githubRepoCount||0;
          const ghCount=data.githubCount||0;
          if(st){
            if(ghRaw>0)st.textContent=ghRaw+" repos on GitHub live";
            else if(ghCount>0)st.textContent=ghCount+" on GitHub";
            else st.textContent="unique products";
          }
        }
        break;
      case"validated":
        if(Array.isArray(data)){
          window._validatedData=data; // set FIRST so renderValidatedQ reads fresh data
          setVal("vQueue",data.length);
          const pc=document.getElementById("pipeCount");if(pc)pc.textContent=data.length+" validated";
          const nb=document.getElementById("navQueueCount");if(nb)nb.textContent=data.length;
          renderValidatedQ(document.getElementById("queueList"),40);
          renderValidatedQ(document.getElementById("fullQueueList"),100);
        }
        break;
      case"built":
        if(Array.isArray(data)){
          window._builtData=data;
          // vTotal is authoritative from stats (uses Math.max of metadata+dirs+accumulated counter)
          // Only fall back to built.length if stats haven't arrived yet
          if(document.getElementById("vTotal")?.textContent==="--")setVal("vTotal",data.length);
          renderBuiltList(document.getElementById("builtList"),25);
          renderBuiltList(document.getElementById("fullBuiltList"),200);
        }
        break;
      case"logs":
        if(Array.isArray(data)&&JSON.stringify(data)!==window._lastLogsHash){
          window._lastLogsHash=JSON.stringify(data.slice(-5));
          rawLogs=data;renderFilteredLogs("logViewer");renderFilteredLogs("fullLogViewer");renderAllLogPanels();
        }
        break;
      case"progress":
        if(data){applyPipelineProgress(data)}
        break;
      case"current":
        if(data!==undefined){applyCurrentBuild(data)}
        break;
      case"signals":
        if(data){applySignals(data)}
        break;
      case"squadron":
        if(Array.isArray(data)&&data.length){squadronData=data;renderSquadronCards();if(currentPage==="agents")renderAgentsPage()}
        break;
    }
    document.getElementById("lastUpdate").textContent=new Date().toLocaleTimeString();
  }catch(e){}
}

function connectSSE(){
  const es=new EventSource("/api/stream");
  const dot=document.getElementById("liveDot");

  es.onopen=()=>{
    sseActive=true;sseRetryCount=0;
    if(dot){dot.classList.remove("disconnected");dot.title="Live (SSE)"}
  };

  ["status","stats","validated","built","logs","progress","current","signals","squadron"].forEach(ev=>{
    es.addEventListener(ev,e=>{
      try{applySSEEvent(ev,JSON.parse(e.data))}catch{}
    });
  });

  es.onerror=()=>{
    sseActive=false;
    if(dot){dot.classList.add("disconnected");dot.title="Polling (SSE disconnected)"}
    es.close();
    sseRetryCount++;
    if(sseRetryCount<=MAX_SSE_RETRIES){
      const delay=Math.min(2000*Math.pow(1.5,sseRetryCount-1),30000);
      setTimeout(connectSSE,delay);
    }
  };
}

/* ========== ADAPTIVE POLLING (fallback + supplement when SSE active) ========== */
// Extract shared rendering functions so both SSE events and polling can call them
function renderValidatedQ(el,limit){
  const vQueue=window._validatedData||[];
  if(!el)return;
  if(!vQueue.length){el.innerHTML='<div class="empty"><div class="empty-icon">&#9989;</div>No validated ideas yet &mdash; awaiting research cycle</div>';return}
  el.innerHTML=vQueue.slice(0,limit).map((idea,i)=>{
    const v=idea.validation||{};const score=v.overallScore||0;const pct=Math.min(100,(score/10)*100);
    const src=idea.sourcePlatform||"reddit";
    const srcColor=src==="hackernews"?"#ff6600":src==="devto"?"#60a5fa":"#ff6200";
    const srcLabel=src==="hackernews"?"HN":src==="devto"?"Dev.to":"Reddit";
    const verdictColor=(v.verdict==="build")?"#10b981":(v.verdict==="revisit")?"#f59e0b":"#ef4444";
    const subScores=v.marketDemand?('<span title="Market demand">&#128200; '+v.marketDemand+'</span>'+'<span title="Competition gap">&#129354; '+v.competitionGap+'</span>'+'<span title="Feasibility">&#9881; '+v.technicalFeasibility+'</span>'):'';
    const angle=v.uniqueAngle?('<div style="font-size:0.65rem;color:#a78bfa;margin-top:0.15rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:200px" title="'+esc(v.uniqueAngle)+'">&#9889; '+esc((v.uniqueAngle||'').slice(0,60))+'</div>'):'';
    return'<div class="list-item" style="animation:fade-in-up 0.4s var(--ease-out-expo) '+(i*0.03)+'s both">'
     +'<span class="list-rank">'+(i+1)+'</span>'
     +'<span style="font-size:0.55rem;font-weight:700;padding:0.1rem 0.35rem;border-radius:4px;background:'+srcColor+'18;color:'+srcColor+';border:1px solid '+srcColor+'33;white-space:nowrap">'+srcLabel+'</span>'
     +'<span class="badge '+badgeCls(idea.type)+'">'+badgeLbl(idea.type)+'</span>'
     +'<div class="list-info"><div class="list-title" title="'+esc(idea.title||'')+'">'+esc(idea.title||'Untitled')+'</div>'
     +'<div class="list-meta">'+( idea.features?'<span>'+idea.features.length+' features</span>':'')+( idea.estimatedHours?'<span>~'+idea.estimatedHours+'h</span>':'')+subScores+'</div>'
     +angle+'</div>'
     +'<div class="score-wrap"><span class="score-num" style="color:'+verdictColor+'">'+score.toFixed(1)+'</span>'
     +'<div class="score-bar"><div class="score-fill '+scoreCls(pct)+'" style="width:'+pct+'%"></div></div>'
     +'<span style="font-size:0.55rem;color:'+verdictColor+';font-weight:600;text-transform:uppercase;margin-top:0.1rem">'+(v.verdict||'build')+'</span></div>'
     +'</div>';
  }).join("")
}

// SVG icons for deployment buttons (static strings, no user data)
const GH_ICON='<svg viewBox="0 0 16 16" fill="currentColor" width="11" height="11"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>';
const VERCEL_ICON='<svg viewBox="0 0 116 100" fill="currentColor" width="10" height="10"><path d="M57.5 0L115 100H0L57.5 0z"/></svg>';

function renderBuiltList(el,limit){
  const built=window._builtData||[];
  if(!el)return;
  if(!built.length){el.innerHTML='<div class="empty"><div class="empty-icon">&#128640;</div>No builds shipped yet</div>';return}
  const ghUser=window._githubUsername||"malikmuhammadsaadshafiq-dev";
  el.innerHTML=built.slice(0,limit).map((b,i)=>{
    const slug=b.slug||(b.title||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");
    const ghUrl=b.githubUrl||(slug?"https://github.com/"+ghUser+"/"+slug:null);
    const vercelUrl=b.liveUrl||b.vercelUrl||null;
    let links='<div class="link-row">';
    if(ghUrl)links+='<a href="'+esc(ghUrl)+'" target="_blank" class="link-btn link-btn-gh" title="View on GitHub">'+GH_ICON+'<span>GitHub</span></a>';
    if(vercelUrl)links+='<a href="'+esc(vercelUrl)+'" target="_blank" class="link-btn link-btn-vercel" title="View live on Vercel">'+VERCEL_ICON+'<span>Live</span><span class="link-live-dot"></span></a>';
    links+='</div>';
    const dirBadge=b._dirOnly?'<span style="font-size:0.5rem;padding:0.1rem 0.3rem;border-radius:3px;background:rgba(139,92,246,0.15);color:#a78bfa;border:1px solid rgba(139,92,246,0.2)">dir</span>':'';
    const score=b._dirOnly?'--':(b.functionalityScore||b.qualityScore||'?');
    const time=b.builtAt?relTime(b.builtAt):'';
    return'<div class="list-item" style="animation:fade-in-up 0.4s var(--ease-out-expo) '+(i*0.03)+'s both">'
      +'<span class="list-rank">'+(i+1)+'</span>'
      +'<span class="badge '+badgeCls(b.type)+'">'+badgeLbl(b.type)+'</span>'
      +monetizeBadge(b.monetizationType)
      +dirBadge
      +'<div class="list-info"><div class="list-title" title="'+esc(b.title||"")+'">'+esc(b.title||"Untitled")+'</div>'
      +'<div class="list-meta">'+(b._dirOnly?'<span style="color:#4a5568">no metadata</span>':'<span>Score: '+score+'/8</span>')+(time?'<span>'+time+'</span>':'')+'</div>'
      +'</div>'+links+'</div>'
  }).join("")
}

function applyPipelineProgress(pipeProgress){
  const banner=document.getElementById("pipelineActivityBanner");if(!banner)return;
  const isActive=pipeProgress.phase!=="idle";
  banner.style.display=isActive?"flex":"none";
  if(isActive){
    banner.className="pipeline-activity "+pipeProgress.phase+" ani";
    document.getElementById("paPhase").textContent=pipeProgress.phase;
    const detailEl=document.getElementById("paDetail");
    const action=pipeProgress.currentAction||pipeProgress.detail||"";
    detailEl.textContent=action;detailEl.title=action;
    const cnt=document.getElementById("paCount");
    if(pipeProgress.stats){const s=pipeProgress.stats;cnt.textContent=(s.validated!=null?s.validated+" ok":"")+(s.rejected!=null?" | "+s.rejected+" rej":"")+(s.found!=null?" / "+s.found:"");}
    else cnt.textContent=pipeProgress.ideaCount?(pipeProgress.ideaCount+" ideas"):"";
  }
  // Adaptive polling: faster when pipeline is active
  updatePollInterval(isActive?4000:15000);
  // Update architecture diagram
  applyArchitectureState(pipeProgress);
}

function applyCurrentBuild(current){
  const card=document.getElementById("currentCard");const content=document.getElementById("currentContent");const phase=document.getElementById("buildPhase");
  if(!card)return;
  if(current){
    card.classList.add("active");phase.textContent="building";phase.style.color="#a78bfa";
    content.innerHTML='<div class="build-active"><div class="build-spinner"></div><div class="build-info"><h3>'+esc(current.title)+'</h3><p>Started '+relTime(current.startedAt)+' &bull; Generating code, testing, deploying...</p></div></div><div class="build-progress"><div class="build-progress-bar"></div></div>';
    updatePollInterval(4000);
  }else{
    card.classList.remove("active");phase.textContent="idle";phase.style.color="";
    content.innerHTML='<div class="build-idle"><div class="idle-icon">&#128564;</div><div class="idle-text">Idle &mdash; waiting for next build cycle</div><div class="idle-sub">The daemon checks the queue every 5 minutes</div></div>';
  }
}

function applySignals(signals){
  const allSigs=signals.signals||[];
  window._allSignals=allSigs;
  if(document.getElementById("vSignals"))setVal("vSignals",allSigs.length);
  if(document.getElementById("subSignals"))document.getElementById("subSignals").textContent=allSigs.length>0?"Multi-source":"no data";
  const kwCount=allSigs.filter(s=>s.keywords&&s.keywords.length>0).length;
  const uniqueSources=[...new Set(allSigs.map(s=>s.source||"reddit"))];
  setVal("sigTotal",allSigs.length);setVal("sigKw",kwCount);setVal("sigSubs",uniqueSources.length);setVal("sigFiles",signals.totalFiles||0);
  const sc=document.getElementById("sigCount");if(sc)sc.textContent=allSigs.length+" signals";
  const fs2=document.getElementById("flowSource");if(fs2)fs2.textContent=allSigs.length>0?"Multi-source":"AI-only";
  const src=signals.sources||{};
  const srcREl=document.getElementById("srcCountReddit");if(srcREl)srcREl.textContent=src.reddit?"("+src.reddit+")":"";
  const srcHEl=document.getElementById("srcCountHN");if(srcHEl)srcHEl.textContent=src.hackernews?"("+src.hackernews+")":"";
  const srcDEl=document.getElementById("srcCountDevto");if(srcDEl)srcDEl.textContent=src.devto?"("+src.devto+")":"";
  renderSignalList(allSigs,window._activeSignalFilter||"all");
  const chartEl=document.getElementById("subChart");
  if(allSigs.length&&chartEl){
    const subCounts={};
    allSigs.forEach(s=>{const lbl=s.source==="hackernews"?"Hacker News":s.source==="devto"?(s.subreddit||"Dev.to"):(s.subreddit?"r/"+s.subreddit:"Reddit");subCounts[lbl]=(subCounts[lbl]||0)+1;});
    const sorted=Object.entries(subCounts).sort((a,b)=>b[1]-a[1]).slice(0,12);
    const max=sorted[0]?sorted[0][1]:1;
    chartEl.innerHTML=sorted.map(([name,count])=>{const pct=Math.round((count/max)*100);const clr=name==="Hacker News"?"#ff6600":(name.startsWith("Dev.to")||(!name.startsWith("r/")))?"#60a5fa":"#ff6200";return'<div class="sub-row"><span class="sub-name" style="max-width:110px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="'+esc(name)+'">'+esc(name)+'</span><div class="sub-bar-wrap"><div class="sub-bar" style="width:'+pct+'%;background:'+clr+'"></div></div><span class="sub-count">'+count+'</span></div>';}).join("")
  }else if(chartEl){chartEl.innerHTML='<div class="empty" style="padding:1rem"><div class="empty-icon">&#128202;</div>No data yet</div>'}
}

/* ========== ARCHITECTURE STATE ========== */
const archPhaseMap={
  researching:{Sources:"research",RA:"research"},
  validating:{VA:"validating"},
  building:{FA:"building",BA:"building",PM:"pm"},
};
const archActiveClass={research:"active-research",validating:"active-validating",building:"active-building",pm:"active-pm"};
const archStatusClass={research:"s-research",validating:"s-validating",building:"s-building",pm:"s-pm"};
const archStatusLabel={research:"Active",validating:"Active",building:"Building",pm:"Active"};
const archNodeIds=["Sources","RA","VA","FA","BA","PM","Deploy"];

function applyArchitectureState(pipeProgress){
  if(!pipeProgress)return;
  const phase=pipeProgress.phase||"idle";
  const phaseAgents=archPhaseMap[phase]||{};

  // Reset all nodes
  archNodeIds.forEach(id=>{
    const node=document.getElementById("archNode"+id);
    const status=document.getElementById("archStatus"+id);
    if(node){node.classList.remove("active-research","active-validating","active-building","active-pm","step-done")}
    if(status){status.className="arch-node-status";status.textContent=""}
  });

  if(phase!=="idle"){
    // Mark active nodes
    Object.entries(phaseAgents).forEach(([id,sType])=>{
      const node=document.getElementById("archNode"+id);
      const status=document.getElementById("archStatus"+id);
      if(node)node.classList.add(archActiveClass[sType]||"");
      if(status){status.classList.add(archStatusClass[sType]||"s-research");status.textContent=archStatusLabel[sType]||"Active"}
    });
    // Mark idle downstream nodes
    const order=["Sources","RA","VA","FA","BA","PM","Deploy"];
    const activeSet=new Set(Object.keys(phaseAgents));
    let pastActive=false;
    order.forEach(id=>{
      if(activeSet.has(id)){pastActive=true;return}
      const status=document.getElementById("archStatus"+id);
      if(status&&!pastActive){status.classList.add("s-done");status.textContent="Done"}
      else if(status&&pastActive){status.classList.add("s-idle");status.textContent="Idle"}
    });
  }

  // Update stats
  const s=pipeProgress.stats||{};
  const srcEl=document.getElementById("archStatSources");if(srcEl)srcEl.textContent=s.found?(s.found+" posts"):"â€”";
  const raEl=document.getElementById("archStatRA");if(raEl)raEl.textContent=s.found?(s.found+" raw"):"â€”";
  const vaEl=document.getElementById("archStatVA");if(vaEl)vaEl.textContent=s.validated!=null?(s.validated+" ok / "+(s.rejected||0)+" rej"):"â€”";
  const depEl=document.getElementById("archStatDeploy");if(depEl&&window._builtData)depEl.textContent=window._builtData.length+" shipped";

  // Live bar
  const lb=document.getElementById("archLiveBar");
  if(lb){
    const action=pipeProgress.currentAction||"";
    if(action){
      lb.innerHTML='<span style="width:7px;height:7px;border-radius:50%;background:#34d399;box-shadow:0 0 8px #34d399;animation:pulse-dot 1.5s infinite;display:inline-block;flex-shrink:0"></span><span style="color:#8892a4">'+esc(action)+'</span>';
    }else if(phase!=="idle"){
      lb.innerHTML='<span style="width:7px;height:7px;border-radius:50%;background:#a78bfa;box-shadow:0 0 8px #a78bfa;animation:pulse-dot 1.5s infinite;display:inline-block;flex-shrink:0"></span><span style="color:#8892a4">Pipeline '+esc(phase)+'</span>';
    }else{
      lb.innerHTML='<span style="color:#4a5568">Idle &mdash; awaiting next cycle</span>';
    }
  }
}

/* ========== ADAPTIVE POLL INTERVAL ========== */
let _pollInterval=12000;
let _pollTimer=null;
function updatePollInterval(ms){
  if(_pollInterval===ms)return;
  _pollInterval=ms;
  clearInterval(_pollTimer);
  _pollTimer=setInterval(()=>{if(!sseActive)refreshAll();},_pollInterval);
}

/* ========== MAIN REFRESH (polling fallback) ========== */
let _refreshing=false;
async function refreshAll(){
  if(_refreshing)return;
  _refreshing=true;
  try{
    const results=await Promise.allSettled([
      api("/api/status"),api("/api/stats"),api("/api/validated"),
      api("/api/built"),api("/api/logs"),api("/api/current"),api("/api/system"),
      api("/api/signals"),api("/api/squadron"),api("/api/pipeline-progress"),
    ]);
    const [status,stats,validated,built,logs,current,sys,signals,squadron,pipeProgress]=results.map(r=>r.status==="fulfilled"?r.value:null);

    if(status)applySSEEvent("status",status);
    if(stats)applySSEEvent("stats",stats);
    if(validated)applySSEEvent("validated",validated);
    if(built){window._builtData=built;setVal("vTotal",built.length);renderBuiltList(document.getElementById("builtList"),25);renderBuiltList(document.getElementById("fullBuiltList"),200);}
    if(logs){rawLogs=logs;renderFilteredLogs("logViewer");renderFilteredLogs("fullLogViewer");renderAllLogPanels();}
    if(current)applyCurrentBuild(current);
    if(sys){const loadEl=document.getElementById("sysLoad");if(sys.load){loadEl.textContent="Load: "+sys.load;loadEl.style.display="inline"}else loadEl.style.display="none"}
    if(signals)applySignals(signals);
    if(squadron&&squadron.length){squadronData=squadron;renderSquadronCards();if(currentPage==="agents")renderAgentsPage();}
    if(pipeProgress)applyPipelineProgress(pipeProgress);

    document.getElementById("lastUpdate").textContent=new Date().toLocaleTimeString();
    if(firstLoad){firstLoad=false;toast("Dashboard connected");loadSkills().then(()=>{renderSkills();document.getElementById("navSkillCount").textContent=skillsData.length})}
  }finally{_refreshing=false;}
}

// Init
refreshAll();
connectSSE();
// Polling fallback â€” only fires if SSE is not active
_pollTimer=setInterval(()=>{if(!sseActive)refreshAll();},_pollInterval);
</script>
</body>
</html>
